var T=(l,u,i)=>new Promise((w,t)=>{var S=r=>{try{h(i.next(r))}catch(j){t(j)}},g=r=>{try{h(i.throw(r))}catch(j){t(j)}},h=r=>r.done?w(r.value):Promise.resolve(r.value).then(S,g);h((i=i.apply(l,u)).next())});import{W as Z,f as ee,g as se,r as a,Y as b,j as e,B as I,d as n,C as v,n as y,p as D,U as B,m as C,t as F,L as R,I as E}from"./index-BuhN-Fih.js";import{T as te,a as re,b as M,c as o,d as ae,e as d}from"./table-Di1K6FQQ.js";import{useDriversStore as ne}from"./driversStore-DrdfUmne.js";import{A as L}from"./arrow-left-DbIVj4bg.js";import{P as de,C as ce}from"./phone-Dsz7aCTL.js";import{C as A}from"./calendar-BU-KBc-y.js";import{P,W as oe}from"./weight-DgOqBUCU.js";import{C as le}from"./circle-check-big-DloTBOJE.js";function Ne(){const{driverId:l}=Z(),u=ee(),i=se(),{getCurrentCycleDates:w}=ne(),[t,S]=a.useState(null),[g,h]=a.useState([]),[r,j]=a.useState({total_orders:0,completed_orders:0,pending_orders:0,total_tons:0}),[N,H]=a.useState({total_orders:0,completed_orders:0,pending_orders:0,total_tons:0}),[Y,k]=a.useState(!0),[x,z]=a.useState(""),[m,W]=a.useState(""),[_,U]=a.useState(!1),O=w(),J=q(),$=G();function q(){const s=new Date,f=s.getDate(),c=s.getMonth(),p=s.getFullYear();return f>=25?new Date(p,c,25).toISOString().split("T")[0]:new Date(p,c-1,25).toISOString().split("T")[0]}function G(){const s=new Date,f=s.getDate(),c=s.getMonth(),p=s.getFullYear();return f>=25?new Date(p,c+1,25).toISOString().split("T")[0]:new Date(p,c,25).toISOString().split("T")[0]}a.useEffect(()=>{l&&K()},[l,i.pathname]),a.useEffect(()=>{t&&x&&m&&Q()},[t,x,m]);const K=()=>T(null,null,function*(){if(l){k(!0);try{const s=yield b.getById(l);if(!s){u("/drivers");return}S(s);const f=yield b.getDriverOrders(s.name);h(f);const c=yield b.getDriverMetricsForDateRange(s.name,J,$);j(c)}catch(s){console.error("Failed to load driver data:",s)}finally{k(!1)}}}),Q=()=>T(null,null,function*(){if(!(!t||!x||!m))try{const s=yield b.getDriverMetricsForDateRange(t.name,x,m);H(s)}catch(s){console.error("Failed to load custom range metrics:",s)}}),V=s=>{switch(s){case"completed":return e.jsx(n,{className:"bg-success text-success-foreground",children:"Completed"});case"in-progress":return e.jsx(n,{className:"bg-tertiary text-tertiary-foreground",children:"In Progress"});case"delayed":return e.jsx(n,{className:"bg-warning text-warning-foreground",children:"Delayed"});case"pending":return e.jsx(n,{className:"bg-gray-400 text-white",children:"Pending"});case"delivered":return e.jsx(n,{className:"bg-green-600 text-white",children:"Delivered"});default:return e.jsx(n,{className:"bg-gray-400 text-white",children:s})}},X=s=>e.jsx(n,{className:s==="morning"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800",children:s==="morning"?"Morning":"Night"});return Y?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading driver details..."})]})}):t?e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(I,{variant:"ghost",size:"sm",onClick:()=>u("/drivers"),className:"text-foreground hover:bg-accent",children:[e.jsx(L,{size:16}),"Back to Drivers"]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-headline font-bold text-foreground",children:t.name}),e.jsx("p",{className:"text-muted-foreground",children:"Driver performance and order history"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(n,{className:t.is_active?"bg-success text-success-foreground":"bg-gray-400 text-white",children:t.is_active?"Active":"Inactive"})})]}),e.jsxs(v,{children:[e.jsx(y,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5"}),"Driver Information"]})}),e.jsx(C,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Full Name"}),e.jsx("p",{className:"font-medium text-foreground",children:t.name})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(de,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Phone Number"}),e.jsx("a",{href:`tel:${t.phone_number.replace(/[\s\-\(\)]/g,"")}`,className:"font-medium text-primary hover:text-primary/80 underline",children:t.phone_number})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Joined"}),e.jsx("p",{className:"font-medium text-foreground",children:t.created_at?new Date(t.created_at).toLocaleDateString():"N/A"})]})]})]})})]}),e.jsxs(v,{children:[e.jsxs(y,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"Current Cycle Performance"]}),e.jsxs(F,{children:["Performance metrics for ",O.start," - ",O.end]})]}),e.jsx(C,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 border border-border rounded-lg",children:[e.jsx(P,{className:"h-8 w-8 text-primary mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:r.total_orders}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Orders"})]}),e.jsxs("div",{className:"text-center p-4 border border-border rounded-lg",children:[e.jsx(le,{className:"h-8 w-8 text-success mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:r.completed_orders}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completed"})]}),e.jsxs("div",{className:"text-center p-4 border border-border rounded-lg",children:[e.jsx(ce,{className:"h-8 w-8 text-warning mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:r.pending_orders}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending"})]}),e.jsxs("div",{className:"text-center p-4 border border-border rounded-lg",children:[e.jsx(oe,{className:"h-8 w-8 text-tertiary mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:r.total_tons}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Tons"})]})]})})]}),e.jsxs(v,{children:[e.jsx(y,{children:e.jsxs(D,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"Custom Date Range Analysis"]}),e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>U(!_),children:[_?"Hide":"Show"," Custom Range"]})]})}),_&&e.jsx(C,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"start-date",children:"Start Date"}),e.jsx(E,{id:"start-date",type:"date",value:x,onChange:s=>z(s.target.value),className:"bg-background text-foreground border-border"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"end-date",children:"End Date"}),e.jsx(E,{id:"end-date",type:"date",value:m,onChange:s=>W(s.target.value),className:"bg-background text-foreground border-border"})]})]}),x&&m&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-4",children:[e.jsxs("div",{className:"text-center p-4 bg-muted/30 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-foreground",children:N.total_orders}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Orders"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/30 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-foreground",children:N.completed_orders}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completed"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/30 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-foreground",children:N.pending_orders}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/30 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-foreground",children:N.total_tons}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Tons"})]})]})]})})]}),e.jsxs(v,{children:[e.jsxs(y,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"Order History"]}),e.jsxs(F,{children:["Complete order history for ",t.name," (",g.length," orders total)"]})]}),e.jsx(C,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(te,{children:[e.jsx(re,{children:e.jsxs(M,{className:"border-border",children:[e.jsx(o,{className:"text-foreground",children:"Order ID"}),e.jsx(o,{className:"text-foreground",children:"Customer"}),e.jsx(o,{className:"text-foreground",children:"Date"}),e.jsx(o,{className:"text-foreground",children:"Status"}),e.jsx(o,{className:"text-foreground",children:"Tons"}),e.jsx(o,{className:"text-foreground",children:"Shift"}),e.jsx(o,{className:"text-foreground",children:"Company"})]})}),e.jsx(ae,{children:g.length>0?g.map(s=>e.jsxs(M,{className:"border-border hover:bg-muted/50",children:[e.jsx(d,{className:"font-mono text-foreground",children:s.id}),e.jsx(d,{className:"text-foreground",children:s.customer_name}),e.jsx(d,{className:"text-foreground",children:s.date}),e.jsx(d,{children:V(s.status)}),e.jsxs(d,{className:"text-foreground",children:[s.tons," tons"]}),e.jsx(d,{children:X(s.shift)}),e.jsx(d,{className:"text-foreground",children:s.company||"N/A"})]},s.id)):e.jsx(M,{children:e.jsx(d,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No orders found for this driver yet."})})})]})})})]})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Driver Not Found"}),e.jsxs(I,{onClick:()=>u("/drivers"),children:[e.jsx(L,{size:16}),"Back to Drivers"]})]})})}export{Ne as DriverDetail};
