var z=Object.defineProperty,A=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var R=(n,a,r)=>a in n?z(n,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[a]=r,$=(n,a)=>{for(var r in a||(a={}))q.call(a,r)&&R(n,r,a[r]);if(M)for(var r of M(a))U.call(a,r)&&R(n,r,a[r]);return n},I=(n,a)=>A(n,P(a));var C=(n,a,r)=>new Promise((h,N)=>{var p=i=>{try{f(r.next(i))}catch(u){N(u)}},x=i=>{try{f(r.throw(i))}catch(u){N(u)}},f=i=>i.done?h(i.value):Promise.resolve(i.value).then(p,x);f((r=r.apply(n,a)).next())});import{c as Y,b as Q,r as d,j as e,C as L,B as H,X,I as G,a as J,g as K,h as Z,s as D,n as ee,p as se,m as te}from"./index-BuhN-Fih.js";import{T as ae,a as re,b as W,c as ne,d as oe,e as le}from"./table-Di1K6FQQ.js";import{S as ie}from"./square-pen-DJxX0RVp.js";import{C as me}from"./circle-check-big-DloTBOJE.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],de=Y("save",ce);function ue({tableName:n,data:a,canEdit:r,lowStockThreshold:h,onUpdate:N,customHeaders:p}){const{toast:x}=Q(),[f,i]=d.useState(!1),[u,y]=d.useState({}),[g,S]=d.useState(!1);if(d.useEffect(()=>{i(!1),y({})},[a]),!a||a.length===0)return e.jsx(L,{children:e.jsx("div",{className:"p-6 text-center py-8 text-muted-foreground",children:"No data available for this table"})});const b=Object.keys(a[0]).filter(s=>s!=="id"&&s!=="created_at"&&s!=="updated_at"),t=a,o=s=>{if(s==null)return"-";const l=Number(s);return isNaN(l)?String(s):l.toFixed(3)},j=s=>{if(h===null)return!1;const l=Number(s);return isNaN(l)?!1:l<h},w=(s,l,m)=>{y(c=>I($({},c),{[`${s}_${l}`]:m}))},v=()=>C(null,null,function*(){S(!0);const s=Object.entries(u);if(s.length===0){i(!1),S(!1);return}try{for(const[l,m]of s){const c=l.split("_"),E=c[0],k=c.slice(1).join("_"),T=Number(m);if(isNaN(T))throw new Error(`Invalid numeric value for ${k}`);yield N(n,Number(E),k,T)}x({title:"Success",description:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Changes saved successfully"})]})}),i(!1),y({})}catch(l){x({title:"Error",description:`Failed to save changes: ${l}`,variant:"destructive"})}finally{S(!1)}}),_=()=>{i(!1),y({})},B=(s,l)=>{var c;const m=`${s.id}_${l}`;return u[m]!==void 0?u[m]:String((c=s[l])!=null?c:"")};return e.jsx(L,{children:e.jsxs("div",{className:"p-6 space-y-4",children:[r&&e.jsx("div",{className:"flex justify-end gap-2",children:f?e.jsxs(e.Fragment,{children:[e.jsxs(H,{onClick:_,variant:"outline",size:"sm",className:"gap-2",disabled:g,children:[e.jsx(X,{className:"h-4 w-4"}),"Cancel"]}),e.jsxs(H,{onClick:v,variant:"default",size:"sm",className:"gap-2",disabled:g,children:[e.jsx(de,{className:"h-4 w-4"}),g?"Saving...":"Save Changes"]})]}):e.jsxs(H,{onClick:()=>i(!0),variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"Edit Values"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ae,{children:[e.jsx(re,{children:e.jsx(W,{className:"border-border",children:b.map(s=>e.jsx(ne,{className:"text-foreground",children:p&&p[s]?p[s]:s.replace(/_/g," ").toUpperCase()},s))})}),e.jsx(oe,{children:t.map((s,l)=>e.jsx(W,{className:"border-border hover:bg-muted/50",children:b.map(m=>{const c=s[m],E=!isNaN(Number(c))&&c!==null,T=f&&E&&!(m==="type"||m==="total"),F=j(c);return e.jsx(le,{className:`text-foreground ${F?"bg-red-50 text-red-700 font-medium":""}`,children:T?e.jsx(G,{type:"number",step:"0.001",value:B(s,m),onChange:O=>w(s.id,m,O.target.value),className:"w-full max-w-[150px] h-8 text-sm"}):e.jsx("span",{className:E||m==="total"?"font-mono":"",children:o(c)})},m)})},s.id||l))})]})}),h&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["* Values below ",h," tons are highlighted in red"]})]})})}const V=[{name:"qatar_steel",displayName:"Qatar Steel",lowStockThreshold:100,customHeaders:void 0},{name:"al_watania_steel",displayName:"AlWatania Steel",lowStockThreshold:100,customHeaders:void 0},{name:"special_length",displayName:"Special Length Watania Sections",lowStockThreshold:100,customHeaders:{type:"Length","16mm":"8.25m","20mm":"9m","25mm":"10m","32mm":"11.25m"}},{name:"coils",displayName:"Coils",lowStockThreshold:null,customHeaders:{type:"Coils","5.5mm":"5.5mm","6.5mm":"6.5mm","8mm":"8mm","9mm":"9mm","10mm":"10mm","11mm":"11mm","12mm":"12mm"}},{name:"wire",displayName:"Wire",lowStockThreshold:null,customHeaders:{type:"Type","8mm_6m_bundles":"8mm(6m)(Bundles)",wire_1_6mm_rolls:"wire 1.6mm(Rolls)",wire_3mm_rolls:"Wire 3mm(Rolls)",wire_mesh_10mm_sheet:"Wire mesh 10mm(Sheet)",wire_mesh_8mm_sheet:"Wire mesh 8mm(Sheet)",wire_mesh_6mm_sheet:"Wire mesh 6mm(Sheet)"}},{name:"coupler",displayName:"Coupler",lowStockThreshold:null,customHeaders:{type:"Coupler","12mm":"12mm","16mm":"16mm","20mm":"20mm","25mm":"25mm","32mm":"32mm","40mm":"40mm"}}];function je(){var b;const{user:n}=J();K();const[a,r]=d.useState(""),[h,N]=d.useState({}),[p,x]=d.useState(!0),[f,i]=d.useState([]),u=Z((b=n==null?void 0:n.profile)==null?void 0:b.role,"edit");d.useEffect(()=>{const t=new Date,o=`${String(t.getDate()).padStart(2,"0")}/${String(t.getMonth()+1).padStart(2,"0")}/${t.getFullYear()}`;r(o)},[]),d.useEffect(()=>{y();const t=V.map(o=>D.channel(`${o.name}_changes`).on("postgres_changes",{event:"*",schema:"public",table:o.name},()=>{g(o.name)}).subscribe());return i(t),()=>{t.forEach(o=>o.unsubscribe())}},[]);const y=()=>C(null,null,function*(){x(!0);const t=V.map(o=>g(o.name));yield Promise.all(t),x(!1)}),g=t=>C(null,null,function*(){try{const{data:o,error:j}=yield D.from(t).select("*").order("id",{ascending:!0});if(j){console.error(`Error loading ${t}:`,j);return}N(w=>I($({},w),{[t]:o||[]}))}catch(o){console.error(`Failed to load ${t}:`,o)}}),S=(t,o,j,w)=>C(null,null,function*(){try{const v=Math.round(w*1e3)/1e3,{error:_}=yield D.from(t).update({[j]:v}).eq("id",o);if(_)throw console.error(`Error updating ${t}:`,_),_;yield g(t)}catch(v){throw console.error(`Failed to update ${t}:`,v),v}});return p?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Inventory"}),e.jsx("p",{className:"text-muted-foreground",children:a})]}),e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading inventory data..."})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Inventory"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:a})]}),V.map(t=>e.jsxs(L,{children:[e.jsx(ee,{children:e.jsx(se,{children:t.displayName})}),e.jsx(te,{children:e.jsx(ue,{tableName:t.name,data:h[t.name]||[],canEdit:u,lowStockThreshold:t.lowStockThreshold,onUpdate:S,customHeaders:t.customHeaders})})]},t.name))]})}export{je as Inventory};
