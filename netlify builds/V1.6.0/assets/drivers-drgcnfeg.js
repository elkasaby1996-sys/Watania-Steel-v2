var Y=Object.defineProperty,G=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var L=(a,s,t)=>s in a?Y(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t,w=(a,s)=>{for(var t in s||(s={}))Z.call(s,t)&&L(a,t,s[t]);if(S)for(var t of S(s))ee.call(s,t)&&L(a,t,s[t]);return a},_=(a,s)=>G(a,K(s));var D=(a,s,t)=>new Promise((c,o)=>{var d=m=>{try{u(t.next(m))}catch(h){o(h)}},x=m=>{try{u(t.throw(m))}catch(h){o(h)}},u=m=>m.done?c(m.value):Promise.resolve(m.value).then(d,x);u((t=t.apply(a,s)).next())});import{r as b,a as re,b as O,h as te,j as e,B as f,L as C,I as T,f as q,C as k,U as se,d as F,n as U,p as B,t as I,m as z,q as ae,e as ie,g as ne}from"./index-yWCqtgWP.js";import{useDriversStore as P}from"./driversStore-BZVn2IjE.js";import{D as H,a as oe,b as Q,c as R,d as J}from"./dialog-DJKQQ3Aj.js";import{C as W,R as E,a as ce}from"./RoleBasedComponent-Bw7TjrVH.js";import{P as le,A as de,a as me,b as ue,c as he,d as xe,e as ge,f as ve,g as pe,h as fe}from"./alert-dialog-CvYaYMsI.js";import{T as be,a as je,b as M,c as y,d as Ne,e as N}from"./table-CBV96gol.js";import{S as ye}from"./square-pen-Cv1NC3RC.js";import{T as De}from"./trash-2-C6UGCjRC.js";import{C as Ce}from"./circle-check-big-DnuHpE59.js";import{C as Ae}from"./calendar-SSTEyxcS.js";import{P as we,W as _e}from"./weight-C_CrPdNh.js";import{T as ke}from"./trending-up-B7QDpJRm.js";import{A as Te}from"./arrow-left-NIcPJLgR.js";import{S as Pe}from"./search-BMyTM2pA.js";import"./index-UTeR_lmU.js";function Ee(){var i;const[a,s]=b.useState(!1),[t,c]=b.useState({name:"",phoneNumber:"",isActive:!0}),[o,d]=b.useState({}),{addDriver:x}=P(),{user:u}=re(),{toast:m}=O(),h=te((i=u==null?void 0:u.profile)==null?void 0:i.role,"create"),v=()=>{const l={};return t.name.trim()||(l.name="Driver name is required"),t.phoneNumber.trim()?/^\+?[\d\s\-\(\)]+$/.test(t.phoneNumber)||(l.phoneNumber="Please enter a valid phone number"):l.phoneNumber="Phone number is required",d(l),Object.keys(l).length===0},g=l=>D(null,null,function*(){if(l.preventDefault(),!h){m({title:"Access Denied",description:"You don't have permission to create drivers. Contact your administrator.",variant:"destructive"});return}if(v())try{const j={name:t.name.trim(),phone_number:t.phoneNumber.trim(),is_active:t.isActive};yield x(j),m({title:"Driver Created",description:`Driver ${t.name} has been successfully created.`}),c({name:"",phoneNumber:"",isActive:!0}),d({}),s(!1)}catch(j){console.error("Driver creation failed:",j),m({title:"Error",description:j instanceof Error?j.message:"Failed to create driver. Please try again.",variant:"destructive"})}}),r=(l,j)=>{c(A=>_(w({},A),{[l]:j})),o[l]&&d(A=>_(w({},A),{[l]:void 0}))};return h?e.jsxs(H,{open:a,onOpenChange:s,children:[e.jsx(oe,{asChild:!0,children:e.jsxs(f,{className:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-md",children:[e.jsx(le,{size:20}),e.jsx("span",{className:"font-medium",children:"Add New Driver"})]})}),e.jsxs(Q,{className:"sm:max-w-[500px] bg-background text-foreground","aria-describedby":"add-driver-description",children:[e.jsx(R,{children:e.jsx(J,{className:"text-foreground",children:"Add New Driver"})}),e.jsx("div",{id:"add-driver-description",className:"sr-only",children:"Create a new driver with contact information and status."}),e.jsxs("form",{onSubmit:g,className:"space-y-6",id:"add-driver-form",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"add-driver-name",className:"text-foreground",children:"Driver Name *"}),e.jsx(T,{id:"add-driver-name",name:"driverName",value:t.name,onChange:l=>r("name",l.target.value),placeholder:"John Smith",className:`bg-background text-foreground border-border ${o.name?"border-destructive":""}`}),o.name&&e.jsx("p",{className:"text-sm text-destructive",children:o.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"add-driver-phone",className:"text-foreground",children:"Phone Number *"}),e.jsx(T,{id:"add-driver-phone",name:"driverPhone",value:t.phoneNumber,onChange:l=>r("phoneNumber",l.target.value),placeholder:"+1 (555) 123-4567",className:`bg-background text-foreground border-border ${o.phoneNumber?"border-destructive":""}`}),o.phoneNumber&&e.jsx("p",{className:"text-sm text-destructive",children:o.phoneNumber})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{id:"add-driver-active",checked:t.isActive,onCheckedChange:l=>r("isActive",l)}),e.jsx(C,{htmlFor:"add-driver-active",className:"text-foreground",children:"Driver is Active"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>s(!1),className:"bg-background text-foreground border-border hover:bg-accent hover:text-accent-foreground",children:"Cancel"}),e.jsx(f,{type:"submit",className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Create Driver"})]})]})]})]}):null}function Fe({driver:a,open:s,onOpenChange:t}){const[c,o]=b.useState({name:"",phoneNumber:"",isActive:!0}),[d,x]=b.useState({}),{updateDriver:u}=P(),{toast:m}=O();b.useEffect(()=>{a&&o({name:a.name||"",phoneNumber:a.phone_number||"",isActive:a.is_active})},[a]);const h=()=>{const r={};return c.name.trim()||(r.name="Driver name is required"),c.phoneNumber.trim()?/^\+?[\d\s\-\(\)]+$/.test(c.phoneNumber)||(r.phoneNumber="Please enter a valid phone number"):r.phoneNumber="Phone number is required",x(r),Object.keys(r).length===0},v=r=>D(null,null,function*(){if(r.preventDefault(),!(!h()||!a))try{const i={name:c.name.trim(),phone_number:c.phoneNumber.trim(),is_active:c.isActive};yield u(a.id,i),m({title:"Driver Updated",description:`Driver ${c.name} has been successfully updated.`}),t(!1)}catch(i){console.error("Failed to update driver:",i),m({title:"Error",description:i instanceof Error?i.message:"Failed to update driver. Please try again.",variant:"destructive"})}}),g=(r,i)=>{o(l=>_(w({},l),{[r]:i})),d[r]&&x(l=>_(w({},l),{[r]:void 0}))};return a?e.jsx(H,{open:s,onOpenChange:t,children:e.jsxs(Q,{className:"sm:max-w-[500px] bg-background text-foreground","aria-describedby":"edit-driver-description",children:[e.jsx(R,{children:e.jsx(J,{className:"text-foreground",children:"Edit Driver"})}),e.jsx("div",{id:"edit-driver-description",className:"sr-only",children:"Edit driver information including name, phone number, and status."}),e.jsxs("form",{onSubmit:v,className:"space-y-6",id:"edit-driver-form",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"edit-driver-name",className:"text-foreground",children:"Driver Name *"}),e.jsx(T,{id:"edit-driver-name",name:"driverName",value:c.name,onChange:r=>g("name",r.target.value),placeholder:"John Smith",className:`bg-background text-foreground border-border ${d.name?"border-destructive":""}`}),d.name&&e.jsx("p",{className:"text-sm text-destructive",children:d.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"edit-driver-phone",className:"text-foreground",children:"Phone Number *"}),e.jsx(T,{id:"edit-driver-phone",name:"driverPhone",value:c.phoneNumber,onChange:r=>g("phoneNumber",r.target.value),placeholder:"+1 (555) 123-4567",className:`bg-background text-foreground border-border ${d.phoneNumber?"border-destructive":""}`}),d.phoneNumber&&e.jsx("p",{className:"text-sm text-destructive",children:d.phoneNumber})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{id:"edit-driver-active",checked:c.isActive,onCheckedChange:r=>g("isActive",r)}),e.jsx(C,{htmlFor:"edit-driver-active",className:"text-foreground",children:"Driver is Active"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>t(!1),className:"bg-background text-foreground border-border hover:bg-accent hover:text-accent-foreground",children:"Cancel"}),e.jsx(f,{type:"submit",className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Update Driver"})]})]})]})}):null}const $e=({phoneNumber:a})=>{if(!a)return e.jsx("span",{className:"text-muted-foreground",children:"N/A"});const s=a.replace(/[\s\-\(\)]/g,"");return e.jsxs("a",{href:`tel:${s}`,className:"text-primary hover:text-primary/80 underline cursor-pointer inline-flex items-center gap-1",title:"Click to call",children:["ðŸ“ž ",a]})};function ze(){const a=q(),s=P(),{toast:t}=O(),[c,o]=b.useState(null),[d,x]=b.useState(!1),u=(s==null?void 0:s.getFilteredDrivers)||(()=>[]),m=(s==null?void 0:s.deleteDriver)||(()=>Promise.resolve()),h=(s==null?void 0:s.updateDriver)||(()=>Promise.resolve()),v=(s==null?void 0:s.metrics)||[],g=u(),r=Array.isArray(v)?v:[],i=n=>!n||!Array.isArray(r)?{total_orders:0,completed_orders:0,pending_orders:0,total_tons:0}:r.find(p=>p&&p.driver_name===n)||{total_orders:0,completed_orders:0,pending_orders:0,total_tons:0},l=n=>n?e.jsxs(F,{className:"bg-success text-success-foreground",children:[e.jsx(Ce,{size:12,className:"mr-1"}),"Active"]}):e.jsxs(F,{className:"bg-gray-400 text-white",children:[e.jsx(ce,{size:12,className:"mr-1"}),"Inactive"]}),j=n=>{o(n),x(!0)},A=(n,p)=>D(null,null,function*(){try{yield m(n),t({title:"Driver Deleted",description:`Driver ${p} has been successfully deleted.`})}catch($){console.error("Failed to delete driver:",$),t({title:"Error",description:"Failed to delete driver. Please try again.",variant:"destructive"})}}),V=n=>{a(`/drivers/${n.id}`)},X=n=>D(null,null,function*(){const p=!n.is_active;try{yield h(n.id,{is_active:p}),t({title:"Status Updated",description:`Driver ${n.name} is now ${p?"active":"inactive"}.`})}catch($){console.error("Failed to update driver status:",$),t({title:"Error",description:"Failed to update driver status. Please try again.",variant:"destructive"})}});return e.jsxs(k,{children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Drivers List"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[g.length," drivers total"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(be,{children:[e.jsx(je,{children:e.jsxs(M,{className:"border-border",children:[e.jsx(y,{className:"text-foreground",children:"Driver Name"}),e.jsx(y,{className:"text-foreground",children:"Phone Number"}),e.jsx(y,{className:"text-foreground",children:"Status & Actions"}),e.jsx(y,{className:"text-foreground",children:"Total Orders"}),e.jsx(y,{className:"text-foreground",children:"Completed"}),e.jsx(y,{className:"text-foreground",children:"Total Tons"}),e.jsx(y,{className:"text-foreground",children:"Actions"})]})}),e.jsx(Ne,{children:Array.isArray(g)&&g.length>0?g.map(n=>{if(!n||!n.id)return null;const p=i(n.name);return e.jsxs(M,{className:"border-border hover:bg-muted/50",children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{size:16,className:"text-muted-foreground"}),e.jsx(f,{variant:"ghost",className:"font-medium text-foreground hover:text-primary hover:bg-accent p-0 h-auto",onClick:()=>V(n),children:n.name})]})}),e.jsx(N,{children:e.jsx($e,{phoneNumber:n.phone_number})}),e.jsx(N,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[l(n.is_active),e.jsx(E,{action:"edit",children:e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>X(n),className:"text-xs px-2 py-1 h-6",title:`Click to ${n.is_active?"deactivate":"activate"}`,children:n.is_active?"Deactivate":"Activate"})})]})}),e.jsx(N,{className:"text-foreground font-medium",children:p.total_orders}),e.jsx(N,{className:"text-foreground",children:p.completed_orders}),e.jsxs(N,{className:"text-foreground",children:[p.total_tons," tons"]}),e.jsx(N,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{action:"edit",children:e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>j(n),className:"bg-transparent text-foreground hover:bg-accent hover:text-accent-foreground",title:"Edit Driver",children:e.jsx(ye,{size:16})})}),e.jsx(E,{action:"delete",children:e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"sm",className:"bg-transparent text-destructive hover:bg-destructive/10 hover:text-destructive",title:"Delete Driver",children:e.jsx(De,{size:16})})}),e.jsxs(ue,{className:"bg-background text-foreground","aria-describedby":"delete-driver-description",children:[e.jsxs(he,{children:[e.jsx(xe,{children:"Are you sure?"}),e.jsxs(ge,{id:"delete-driver-description",className:"text-muted-foreground",children:["This action cannot be undone. This will permanently delete driver ",n.name||"Unknown Driver","."]})]}),e.jsxs(ve,{children:[e.jsx(pe,{className:"bg-background text-foreground border-border hover:bg-accent",children:"Cancel"}),e.jsx(fe,{onClick:()=>A(n.id,n.name||"Unknown Driver"),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})})]})})]},n.id)}):e.jsx(M,{children:e.jsx(N,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No drivers found. Add your first driver!"})})})]})})]}),e.jsx(Fe,{driver:c,open:d,onOpenChange:x})]})}function Me(){const a=P(),s=(a==null?void 0:a.metrics)||[],t=(a==null?void 0:a.getCurrentCycleDates)||(()=>({start:"N/A",end:"N/A"}));let c={start:"N/A",end:"N/A"};try{c=t()}catch(r){console.error("Error getting cycle dates:",r)}const o=Array.isArray(s)?s:[],d=o.length,x=o.filter(r=>r&&r.is_active).length,u=o.reduce((r,i)=>r+((i==null?void 0:i.total_orders)||0),0),m=o.reduce((r,i)=>r+((i==null?void 0:i.completed_orders)||0),0),h=o.reduce((r,i)=>r+((i==null?void 0:i.total_tons)||0),0),v=d>0?Math.round(u/d*10)/10:0,g=[{title:"Total Drivers",value:d,subtitle:`${x} active`,icon:ae,color:"text-primary",bgColor:"bg-primary/10"},{title:"Total Orders",value:u,subtitle:`${m} completed`,icon:we,color:"text-tertiary",bgColor:"bg-tertiary/10"},{title:"Total Tons Delivered",value:`${Math.round(h*10)/10}`,subtitle:"tons",icon:_e,color:"text-success",bgColor:"bg-success/10"},{title:"Avg Orders/Driver",value:v,subtitle:"per cycle",icon:ke,color:"text-warning",bgColor:"bg-warning/10"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(k,{className:"border-blue-200 bg-blue-50",children:[e.jsxs(U,{className:"pb-3",children:[e.jsxs(B,{className:"flex items-center gap-2 text-blue-800 text-lg",children:[e.jsx(Ae,{className:"h-5 w-5"}),"Current Cycle Period"]}),e.jsx(I,{className:"text-blue-700",children:"Metrics are calculated from the 25th of each month to the 25th of the following month"})]}),e.jsx(z,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(F,{className:"bg-blue-600 text-white",children:[c.start," - ",c.end]}),e.jsx("span",{className:"text-sm text-blue-700",children:"Current reporting period"})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:g.map((r,i)=>e.jsx(k,{children:e.jsx(z,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:r.title}),e.jsx("p",{className:"text-3xl font-bold text-foreground",children:r.value}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:r.subtitle})]}),e.jsx("div",{className:`p-3 rounded-lg ${r.bgColor}`,children:e.jsx(r.icon,{className:`h-6 w-6 ${r.color}`})})]})})},i))}),e.jsxs(k,{children:[e.jsxs(U,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),"Top Performing Drivers (Current Cycle)"]}),e.jsx(I,{children:"Drivers ranked by total completed orders in the current cycle"})]}),e.jsx(z,{children:e.jsxs("div",{className:"space-y-4",children:[o.filter(r=>r&&r.total_orders>0).sort((r,i)=>((i==null?void 0:i.completed_orders)||0)-((r==null?void 0:r.completed_orders)||0)).slice(0,5).map((r,i)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary font-bold",children:i+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:r.driver_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.phone_number})]}),!r.is_active&&e.jsx(F,{variant:"outline",className:"text-xs",children:"Inactive"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-foreground",children:[r.completed_orders," orders"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.total_tons," tons"]})]})]},r.driver_id)),o.filter(r=>r&&r.total_orders>0).length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No orders completed in the current cycle yet."})]})})]})]})}function Ke(){const a=q(),s=ne(),t=P(),[c,o]=b.useState(!0),d=(t==null?void 0:t.searchQuery)||"",x=(t==null?void 0:t.setSearchQuery)||(()=>{}),u=(t==null?void 0:t.loadDrivers)||(()=>Promise.resolve()),m=(t==null?void 0:t.loadMetrics)||(()=>Promise.resolve()),h=(t==null?void 0:t.drivers)||[];return t!=null&&t.error,b.useEffect(()=>{D(null,null,function*(){o(!0),u&&m&&(yield Promise.all([u(),m()])),o(!1)})},[s.pathname]),e.jsx("div",{className:"space-y-6",children:c?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading drivers..."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>a("/"),className:"text-foreground hover:bg-accent",children:[e.jsx(Te,{size:16}),"Back to Dashboard"]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-headline font-bold text-foreground",children:"Drivers Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage drivers and track their performance metrics"})]}),e.jsx(E,{action:"create",children:e.jsx(Ee,{})})]}),e.jsx(Me,{}),e.jsx(k,{children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:16}),e.jsx(T,{id:"drivers-search",name:"driversSearch",placeholder:"Search drivers by name or phone number...",value:d,onChange:v=>x(v.target.value),className:"pl-10 bg-background text-foreground border-border"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[h.length," drivers total"]})]})})}),e.jsx(ze,{})]})})}export{Ke as Drivers};
