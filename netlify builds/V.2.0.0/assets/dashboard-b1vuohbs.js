const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/driversStore-DyKewyrs.js","assets/index-ma71H6Gv.js","assets/index-BPD0O1IK.css"])))=>i.map(i=>d[i]);
var Ne=Object.defineProperty,ve=Object.defineProperties;var je=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var fe=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var ee=(a,d,s)=>d in a?Ne(a,d,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[d]=s,T=(a,d)=>{for(var s in d||(d={}))fe.call(d,s)&&ee(a,s,d[s]);if(Z)for(var s of Z(d))ye.call(d,s)&&ee(a,s,d[s]);return a},F=(a,d)=>ve(a,je(d));var k=(a,d,s)=>new Promise((c,t)=>{var i=x=>{try{p(s.next(x))}catch(j){t(j)}},h=x=>{try{p(s.throw(x))}catch(j){t(j)}},p=x=>x.done?c(x.value):Promise.resolve(x.value).then(i,h);p((s=s.apply(a,d)).next())});import{c as re,r as w,u as S,a as G,b as te,h as R,j as e,B as y,L as b,I as A,_ as De,C as H,d as g,o as we,T as ae}from"./index-ma71H6Gv.js";import{D as ke,a as Ce,b as Se,c as Oe,d as Te}from"./dialog-DRm7bkZI.js";import{S as I,a as L,b as V,c as q,d as C,C as Fe,e as Ae}from"./select-DIwa_4rP.js";import{C as $e,R as E,a as X}from"./RoleBasedComponent-DfoTOiy9.js";import{S as Pe,E as ne,O as Ee}from"./OrderDetailsDialog-DJOUXXC_.js";import{C as Be}from"./CalculatorInput-D0eqxriC.js";import{P as ze}from"./plus-BnJ8CoYp.js";import{P as Me}from"./weight-1r70IWYE.js";import{C as _e}from"./phone-3dYm7qm7.js";import{T as Re,a as Ie,b as K,c as f,d as Le,e as v}from"./table-J_5NzfFx.js";import{A as de,a as oe,b as ie,c as le,d as ce,e as me,f as xe,g as ue,h as he}from"./alert-dialog-iwQT5QSV.js";import{C as Y}from"./circle-check-big-ChAZvRIJ.js";import{S as ge}from"./square-pen-x80yX958.js";import{T as pe}from"./trash-2-BWQ-pNma.js";import{R as Ve,C as qe,T as He}from"./generateCategoricalChart-C3nVHDpr.js";import{P as Ue,a as Je}from"./PieChart-D4uzeZ85.js";import"./index-BHnHYWBN.js";import"./calendar-CO-MNXG0.js";import"./calculator-DUrzhYkl.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"M5 12h14",key:"1ays0h"}]],Ke=re("minus",We);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]],Ye=re("scissors",Xe);function Ge(){var Q;const[a,d]=w.useState(!1),[s,c]=w.useState({deliveryNumber:"",deliveryName:"",company:"",site:"",driverName:"none",phoneNumber:"",status:"in-progress",tons:"",shift:"morning",signedDeliveryNote:!1,orderType:"straight-bar",orderDate:new Date().toISOString().split("T")[0],breakdown:{"8mm":"","10mm":"","12mm":"","14mm":"","16mm":"","18mm":"","20mm":"","25mm":"","32mm":""}}),[t,i]=w.useState({}),[h,p]=w.useState(!1),{addOrder:x}=S(),{user:j}=G(),{toast:$}=te(),[B,P]=w.useState([]);w.useEffect(()=>{a&&k(null,null,function*(){try{const{useDriversStore:l}=yield De(()=>k(null,null,function*(){const{useDriversStore:O}=yield import("./driversStore-DyKewyrs.js");return{useDriversStore:O}}),__vite__mapDeps([0,1,2])),{loadDrivers:m,getActiveDrivers:D}=l.getState();yield m();const N=D();P(N)}catch(l){console.error("Failed to load drivers:",l),P([])}})},[a]);const z=R((Q=j==null?void 0:j.profile)==null?void 0:Q.role,"create"),M=()=>Object.values(s.breakdown).reduce((r,l)=>{const m=parseFloat(l)||0;return r+m},0),n=()=>{const r={};(!s.deliveryNumber||s.deliveryNumber.trim()==="")&&(r.deliveryNumber="Delivery number is required"),(!s.deliveryName||s.deliveryName.trim()==="")&&(r.deliveryName="Delivery name is required"),(!s.company||s.company.trim()==="")&&(r.company="Company is required"),(!s.site||s.site.trim()==="")&&(r.site="Site is required"),(!s.orderDate||s.orderDate.trim()==="")&&(r.orderDate="Order date is required"),s.phoneNumber&&s.phoneNumber.trim()!==""&&!/^\+?[\d\s\-\(\)]+$/.test(s.phoneNumber)&&(r.phoneNumber="Please enter a valid phone number");const l=M(),m=parseFloat(s.tons)||0;!s.tons||s.tons.trim()===""?r.tons="Total tons is required":isNaN(Number(s.tons))||Number(s.tons)<=0?r.tons="Please enter a valid number of tons":l>0&&Math.abs(l-m)>.1&&(r.tons=`Total tons (${m}) doesn't match breakdown total (${l.toFixed(2)})`);const{orders:D,historyOrders:N}=S.getState(),O=s.deliveryNumber,J=D.find(W=>W.id===O),be=N.find(W=>W.id===O);return(J||be)&&(r.deliveryNumber=`Delivery number "${O}" already exists`),i(r),Object.keys(r).length===0},u=r=>k(null,null,function*(){if(r.preventDefault(),!z){$({title:"Access Denied",description:"You don't have permission to create orders. Contact your administrator.",variant:"destructive"});return}if(n())try{const l=s.deliveryNumber,m=Number(s.tons),D=m*100,N={id:l,customerName:s.deliveryName,date:new Date().toISOString().split("T")[0],status:s.status,amount:D,tons:m,shift:s.shift,deliveryNumber:s.deliveryNumber,company:s.company||"",site:s.site||"",driverName:s.driverName==="none"?"":s.driverName||"",phoneNumber:s.phoneNumber||"",signedDeliveryNote:s.signedDeliveryNote,orderType:s.orderType,breakdown:{"8mm":parseFloat(s.breakdown["8mm"])||0,"10mm":parseFloat(s.breakdown["10mm"])||0,"12mm":parseFloat(s.breakdown["12mm"])||0,"14mm":parseFloat(s.breakdown["14mm"])||0,"16mm":parseFloat(s.breakdown["16mm"])||0,"18mm":parseFloat(s.breakdown["18mm"])||0,"20mm":parseFloat(s.breakdown["20mm"])||0,"25mm":parseFloat(s.breakdown["25mm"])||0,"32mm":parseFloat(s.breakdown["32mm"])||0}};yield x(N),$({title:"Order Created",description:`Order ${l} has been successfully created.`}),c({deliveryNumber:"",deliveryName:"",company:"",site:"",driverName:"none",phoneNumber:"",status:"in-progress",tons:"",shift:"morning",signedDeliveryNote:!1,orderType:"straight-bar",breakdown:{"8mm":"","10mm":"","12mm":"","14mm":"","16mm":"","18mm":"","20mm":"","25mm":"","32mm":""}}),i({}),d(!1)}catch(l){console.error("Order creation failed:",l),$({title:"Error",description:l instanceof Error?l.message:"Failed to create order. Please try again.",variant:"destructive"})}}),o=(r,l)=>{c(m=>F(T({},m),{[r]:l})),t[r]&&i(m=>F(T({},m),{[r]:void 0}))},U=(r,l)=>{c(N=>F(T({},N),{breakdown:F(T({},N.breakdown),{[r]:l})}));const m=F(T({},s.breakdown),{[r]:l}),D=Object.values(m).reduce((N,O)=>{const J=parseFloat(O)||0;return N+J},0);D>0&&c(N=>F(T({},N),{tons:D.toFixed(2)}))},_=r=>{d(r),r||(c({deliveryNumber:"",deliveryName:"",company:"",site:"",driverName:"none",phoneNumber:"",status:"in-progress",tons:"",shift:"morning",signedDeliveryNote:!1,orderType:"straight-bar",orderDate:new Date().toISOString().split("T")[0],breakdown:{"8mm":"","10mm":"","12mm":"","14mm":"","16mm":"","18mm":"","20mm":"","25mm":"","32mm":""}}),i({}),p(!1),P([]))};return z?e.jsxs(ke,{open:a,onOpenChange:_,children:[e.jsx(Ce,{asChild:!0,children:e.jsxs(y,{className:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-md",children:[e.jsx(ze,{size:20}),e.jsx("span",{className:"font-medium",children:"Add New Order"})]})}),e.jsxs(Se,{className:"sm:max-w-[700px] bg-background text-foreground max-h-[90vh] overflow-y-auto",children:[e.jsx(Oe,{children:e.jsx(Te,{className:"text-foreground",children:"Create New Order"})}),e.jsxs("form",{onSubmit:u,className:"space-y-6",id:"add-order-form",onReset:()=>{console.log("ðŸ”„ Form reset triggered"),i({}),p(!1)},children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"add-deliveryNumber",className:"text-foreground",children:"Delivery Number * (Can include letters, numbers, special characters)"}),e.jsx(A,{id:"add-deliveryNumber",name:"deliveryNumber",value:s.deliveryNumber,onChange:r=>o("deliveryNumber",r.target.value),placeholder:"Enter any delivery number (e.g., DEL-001, PROJ-2024-ABC, etc.)",className:`bg-background text-foreground border-border ${t.deliveryNumber?"border-destructive":""}`}),t.deliveryNumber&&e.jsx("p",{className:"text-sm text-destructive",children:t.deliveryNumber})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"add-deliveryName",className:"text-foreground",children:"Delivery Name *"}),e.jsx(A,{id:"add-deliveryName",name:"deliveryName",value:s.deliveryName,onChange:r=>o("deliveryName",r.target.value),placeholder:"John Smith",className:`bg-background text-foreground border-border ${t.deliveryName?"border-destructive":""}`}),t.deliveryName&&e.jsx("p",{className:"text-sm text-destructive",children:t.deliveryName})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"add-company",className:"text-foreground",children:"Company *"}),e.jsx(A,{id:"add-company",name:"company",value:s.company,onChange:r=>o("company",r.target.value),placeholder:"Acme Corporation",className:`bg-background text-foreground border-border ${t.company?"border-destructive":""}`}),t.company&&e.jsx("p",{className:"text-sm text-destructive",children:t.company})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"add-site",className:"text-foreground",children:"Site *"}),e.jsx(A,{id:"add-site",name:"site",value:s.site,onChange:r=>o("site",r.target.value),placeholder:"Main Warehouse - Building A",className:`bg-background text-foreground border-border ${t.site?"border-destructive":""}`}),t.site&&e.jsx("p",{className:"text-sm text-destructive",children:t.site})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"add-driverName",className:"text-foreground",children:"Driver Name"}),e.jsxs(I,{name:"driverName",value:s.driverName,onValueChange:r=>{if(o("driverName",r==="none"?"":r),r!=="none"){const m=B.find(D=>D.name===r);m&&o("phoneNumber",m.phone_number)}else o("phoneNumber","")},children:[e.jsx(L,{id:"add-driverName",className:"bg-background text-foreground border-border",children:e.jsx(V,{placeholder:"Select driver (optional)"})}),e.jsxs(q,{className:"bg-popover text-popover-foreground",children:[e.jsx(C,{value:"none",children:"No driver assigned"}),B.map(r=>e.jsx(C,{value:r.name,children:r.name},r.id))]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select from active drivers or leave empty"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"add-phoneNumber",className:"text-foreground",children:"Phone Number"}),e.jsx(A,{id:"add-phoneNumber",name:"phoneNumber",value:s.phoneNumber,onChange:r=>o("phoneNumber",r.target.value),placeholder:"+1 (555) 123-4567 (optional)",className:`bg-background text-foreground border-border ${t.phoneNumber?"border-destructive":""}`}),t.phoneNumber&&e.jsx("p",{className:"text-sm text-destructive",children:t.phoneNumber}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Can be updated later"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"add-order-date",className:"text-foreground",children:"Order Date *"}),e.jsx(A,{id:"add-order-date",name:"orderDate",type:"date",value:s.orderDate,onChange:r=>o("orderDate",r.target.value),className:`bg-background text-foreground border-border ${t.orderDate?"border-destructive":""}`}),t.orderDate&&e.jsx("p",{className:"text-sm text-destructive",children:t.orderDate})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"add-tons",className:"text-foreground",children:"Total Tons *"}),e.jsx(A,{id:"add-tons",name:"tons",type:"number",step:"0.1",value:s.tons,onChange:r=>o("tons",r.target.value),placeholder:"12.5",className:`bg-background text-foreground border-border ${t.tons?"border-destructive":""}`}),t.tons&&e.jsx("p",{className:"text-sm text-destructive",children:t.tons})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"add-shift",className:"text-foreground",children:"Shift"}),e.jsxs(I,{name:"shift",value:s.shift,onValueChange:r=>o("shift",r),children:[e.jsx(L,{id:"add-shift",className:"bg-background text-foreground border-border",children:e.jsx(V,{placeholder:"Select shift"})}),e.jsxs(q,{className:"bg-popover text-popover-foreground",children:[e.jsx(C,{value:"morning",children:"Morning Shift"}),e.jsx(C,{value:"night",children:"Night Shift"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"add-orderType",className:"text-foreground",children:"Order Type *"}),e.jsxs(I,{name:"orderType",value:s.orderType,onValueChange:r=>o("orderType",r),children:[e.jsx(L,{id:"add-orderType",className:"bg-background text-foreground border-border",children:e.jsx(V,{placeholder:"Select order type"})}),e.jsxs(q,{className:"bg-popover text-popover-foreground",children:[e.jsx(C,{value:"straight-bar",children:"Straight Bar"}),e.jsx(C,{value:"cut-and-bend",children:"Cut and Bend"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"add-status",className:"text-foreground",children:"Order Status"}),e.jsxs(I,{name:"status",value:s.status,onValueChange:r=>o("status",r),children:[e.jsx(L,{id:"add-status",className:"bg-background text-foreground border-border",children:e.jsx(V,{placeholder:"Select status"})}),e.jsxs(q,{className:"bg-popover text-popover-foreground",children:[e.jsx(C,{value:"in-progress",children:"In Progress"}),e.jsx(C,{value:"delivered",children:"Delivered"})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($e,{id:"add-signedDeliveryNote",checked:s.signedDeliveryNote,onCheckedChange:r=>o("signedDeliveryNote",r)}),e.jsx(b,{htmlFor:"add-signedDeliveryNote",className:"text-foreground",children:"Signed Delivery Note Received"})]}),e.jsx(Pe,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-foreground",children:"Steel Breakdown (Tons)"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Total: ",M().toFixed(2)," tons"]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:Object.entries(s.breakdown).map(([r,l])=>e.jsxs("div",{className:"space-y-1",children:[e.jsx(b,{htmlFor:`breakdown-${r}`,className:"text-xs text-foreground",children:r}),e.jsx(Be,{id:`breakdown-${r}`,name:`breakdown-${r}`,value:l,onChange:m=>U(r,m),placeholder:"0.0 or =10+5",className:"bg-background text-foreground border-border text-sm h-8",step:"0.1"})]},r))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'Enter tonnage for each steel bar size. Start with "=" for calculations (e.g., =10+5).'})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(y,{type:"button",variant:"outline",onClick:()=>_(!1),className:"bg-background text-foreground border-border hover:bg-accent hover:text-accent-foreground",disabled:h,children:"Cancel"}),e.jsx(y,{type:"submit",className:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-md",disabled:h,children:h?"Creating...":"Create Order"})]})]})]})]}):null}function Qe(){const{user:a}=G(),d=new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),s=new Date().toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});return e.jsx("div",{className:"mb-4 md:mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl sm:text-2xl md:text-3xl font-headline font-bold text-foreground mb-1 sm:mb-2",children:[e.jsx("span",{className:"hidden sm:inline",children:"Al Watania Steel - Daily Orders"}),e.jsx("span",{className:"sm:hidden",children:"Daily Orders"})]}),e.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground",children:[e.jsxs("span",{className:"hidden sm:inline",children:[d," - Track and manage steel deliveries"]}),e.jsx("span",{className:"sm:hidden",children:s})]})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx(E,{action:"create",children:e.jsx(Ge,{})})})]})})}function Ze(){const{stats:a}=S(),d=[{title:"Cut & Bend",value:`${a.cutAndBend} tons`,icon:Ye,color:"text-purple-600",bgColor:"bg-purple-100"},{title:"Straight Bar",value:`${a.straightBar} tons`,icon:Ke,color:"text-blue-600",bgColor:"bg-blue-100"},{title:"Today's Orders",value:a.todayOrders,icon:Me,color:"text-primary",bgColor:"bg-primary/10"},{title:"In Progress",value:a.inProgress,icon:_e,color:"text-tertiary",bgColor:"bg-tertiary/10"}];return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 md:gap-6",children:d.map((s,c)=>e.jsx(H,{className:"p-3 sm:p-4 md:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-muted-foreground mb-1 sm:mb-2 truncate",children:s.title}),e.jsx("p",{className:"text-lg sm:text-xl md:text-3xl font-bold text-foreground truncate",children:s.value})]}),e.jsx("div",{className:`p-2 sm:p-3 rounded-lg ${s.bgColor} flex-shrink-0 ml-2`,children:e.jsx(s.icon,{className:`h-4 w-4 sm:h-5 sm:w-5 md:h-6 md:w-6 ${s.color}`})})]})},c))})}function es({order:a,onView:d,onMarkDelivered:s,onDelete:c,userRole:t,getStatusBadge:i}){const[h,p]=w.useState(!1);return e.jsxs(H,{className:"p-4 mb-3",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[e.jsx("span",{className:"font-mono text-sm font-medium",children:a.id}),i(a.status)]}),e.jsx("p",{className:"font-medium text-foreground",children:a.customerName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.company||"N/A"})]}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>p(!h),className:"p-1",children:h?e.jsx(Fe,{size:18}):e.jsx(Ae,{size:18})})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground mb-2 flex-wrap",children:[e.jsxs("span",{children:[a.tons," tons"]}),e.jsx(g,{className:a.shift==="morning"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800",children:a.shift==="morning"?"AM":"PM"}),e.jsx("span",{children:a.date})]}),h&&e.jsxs("div",{className:"pt-3 border-t border-border space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Site:"}),e.jsx("span",{children:a.site||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Driver:"}),e.jsx("span",{children:a.driverName||"N/A"})]}),a.phoneNumber&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Phone:"}),e.jsx("a",{href:`tel:${a.phoneNumber.replace(/[\s\-\(\)]/g,"")}`,className:"text-primary underline",children:a.phoneNumber})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"Delivery Note:"}),a.signedDeliveryNote?e.jsxs(g,{className:"bg-success text-success-foreground",children:[e.jsx(Y,{size:12,className:"mr-1"}),"Signed"]}):e.jsxs(g,{className:"bg-gray-400 text-white",children:[e.jsx(X,{size:12,className:"mr-1"}),"Not Signed"]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-3 pt-3 border-t border-border",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>d(a),className:"flex-1",children:[R(t,"edit")?e.jsx(ge,{size:14,className:"mr-1"}):e.jsx(ne,{size:14,className:"mr-1"}),R(t,"edit")?"Edit":"View"]}),e.jsx(E,{action:"edit",children:a.status!=="delivered"&&e.jsx(y,{variant:"outline",size:"sm",onClick:()=>s(a.id),className:"text-success border-success hover:bg-success/10",children:e.jsx(ae,{size:14})})}),e.jsx(E,{action:"delete",children:e.jsxs(de,{children:[e.jsx(oe,{asChild:!0,children:e.jsx(y,{variant:"outline",size:"sm",className:"text-destructive border-destructive hover:bg-destructive/10",children:e.jsx(pe,{size:14})})}),e.jsxs(ie,{className:"bg-background text-foreground max-w-[90vw] sm:max-w-lg","aria-describedby":"delete-order-mobile-description",children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Are you sure?"}),e.jsxs(me,{id:"delete-order-mobile-description",className:"text-muted-foreground",children:["This action cannot be undone. This will permanently delete order ",a.id,"."]})]}),e.jsxs(xe,{className:"flex-col sm:flex-row gap-2",children:[e.jsx(ue,{className:"bg-background text-foreground border-border hover:bg-accent",children:"Cancel"}),e.jsx(he,{onClick:()=>c(a.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})})]})]})}function ss(){var M;const{getFilteredTodayOrders:a,deleteOrder:d}=S(),{user:s}=G(),{toast:c}=te(),[t,i]=w.useState(null),[h,p]=w.useState(!1),x=a(),j=(M=s==null?void 0:s.profile)==null?void 0:M.role,$=n=>{switch(n){case"completed":return e.jsx(g,{className:"bg-success text-success-foreground",children:"Completed"});case"in-progress":return e.jsx(g,{className:"bg-tertiary text-tertiary-foreground",children:"In Progress"});case"delayed":return e.jsx(g,{className:"bg-warning text-warning-foreground",children:"Delayed"});case"pending":return e.jsx(g,{className:"bg-gray-400 text-white",children:"Pending"});case"delivered":return e.jsx(g,{className:"bg-green-600 text-white",children:"Delivered"});default:return e.jsx(g,{className:"bg-gray-400 text-white",children:n})}},B=n=>k(null,null,function*(){console.log("ðŸšš Truck button clicked for order:",n);const u=x.find(o=>o.id===n);if(!u)throw new Error("Order not found");console.log("ðŸ“¦ Order details:",{id:u.id,date:u.date,status:u.status});try{const{markAsDelivered:o}=S.getState();yield o(n),console.log("âœ… Order moved to history successfully")}catch(o){throw console.error("âŒ Failed to move order to history:",o),o}}),P=n=>{i(n),p(!0)},z=n=>{d(n),c({title:"Order Deleted",description:`Order ${n} has been successfully deleted.`})};return e.jsxs(H,{children:[e.jsxs("div",{className:"p-3 sm:p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 md:mb-6",children:[e.jsx("h3",{className:"text-base md:text-lg font-semibold text-foreground",children:"Today's Orders"}),e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground",children:[x.length," active orders"]})]}),e.jsx("div",{className:"md:hidden",children:x.length>0?x.map(n=>e.jsx(es,{order:n,onView:P,onMarkDelivered:u=>k(null,null,function*(){try{yield B(u),c({title:"Order Delivered",description:`Order ${u} has been marked as delivered and moved to history.`})}catch(o){c({title:"Error",description:o instanceof Error?o.message:"Failed to mark order as delivered.",variant:"destructive"})}}),onDelete:z,userRole:j,getStatusBadge:$},n.id)):e.jsx("div",{className:"text-center text-muted-foreground py-8",children:"No orders for today yet. Create your first order!"})}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs(Re,{children:[e.jsx(Ie,{children:e.jsxs(K,{className:"border-border",children:[e.jsx(f,{className:"text-foreground",children:"Delivery Number"}),e.jsx(f,{className:"text-foreground",children:"Delivery Name"}),e.jsx(f,{className:"text-foreground",children:"Company"}),e.jsx(f,{className:"text-foreground",children:"Site"}),e.jsx(f,{className:"text-foreground",children:"Date"}),e.jsx(f,{className:"text-foreground",children:"Status"}),e.jsx(f,{className:"text-foreground",children:"Tons"}),e.jsx(f,{className:"text-foreground",children:"Shift"}),e.jsx(f,{className:"text-foreground",children:"Delivery Note"}),e.jsx(f,{className:"text-foreground",children:"Contact"}),e.jsx(f,{className:"text-foreground",children:"Actions"})]})}),e.jsx(Le,{children:x.length>0?x.map(n=>e.jsxs(K,{className:"border-border hover:bg-muted/50",children:[e.jsx(v,{className:"font-mono text-foreground",children:n.id}),e.jsx(v,{className:"text-foreground",children:n.customerName}),e.jsx(v,{className:"text-foreground",children:n.company||"N/A"}),e.jsx(v,{className:"text-foreground",children:n.site||"N/A"}),e.jsx(v,{className:"text-foreground",children:n.date}),e.jsx(v,{children:$(n.status)}),e.jsxs(v,{className:"text-foreground",children:[n.tons," tons"]}),e.jsx(v,{children:e.jsx(g,{className:n.shift==="morning"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800",children:n.shift==="morning"?"Morning":"Night"})}),e.jsx(v,{children:e.jsx(E,{action:"edit",fallback:n.signedDeliveryNote?e.jsxs(g,{className:"bg-success text-success-foreground",children:[e.jsx(Y,{size:12,className:"mr-1"}),"Signed"]}):e.jsxs(g,{className:"bg-gray-400 text-white",children:[e.jsx(X,{size:12,className:"mr-1"}),"Not Signed"]}),children:e.jsx(y,{variant:"ghost",size:"sm",onClick:u=>k(null,null,function*(){u.preventDefault(),u.stopPropagation();try{const o=!n.signedDeliveryNote,U={signed_delivery_note:o};yield we.update(n.id,U);const _=S.getState();_.loadOrders&&(yield _.loadOrders()),c({title:"Delivery Note Updated",description:`Delivery note marked as ${o?"signed":"not signed"}.`})}catch(o){console.error("Failed to update delivery note:",o),c({title:"Error",description:"Failed to update delivery note. Please try again.",variant:"destructive"})}}),className:"p-0 h-auto hover:bg-transparent",title:`Click to mark as ${n.signedDeliveryNote?"not signed":"signed"}`,children:n.signedDeliveryNote?e.jsxs(g,{className:"bg-success text-success-foreground cursor-pointer hover:bg-success/80 transition-colors",children:[e.jsx(Y,{size:12,className:"mr-1"}),"Signed"]}):e.jsxs(g,{className:"bg-gray-400 text-white cursor-pointer hover:bg-gray-500 transition-colors",children:[e.jsx(X,{size:12,className:"mr-1"}),"Not Signed"]})})})}),e.jsx(v,{children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-foreground",children:n.driverName||"N/A"}),n.phoneNumber?e.jsxs("a",{href:`tel:${n.phoneNumber.replace(/[\s\-\(\)]/g,"")}`,className:"text-sm text-primary hover:text-primary/80 underline cursor-pointer",title:"Click to call",children:["ðŸ“ž ",n.phoneNumber]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"-"})]})}),e.jsx(v,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>P(n),className:"bg-transparent text-foreground hover:bg-accent hover:text-accent-foreground",title:R(j,"edit")?"Edit Order Details":"View Order Details",children:R(j,"edit")?e.jsx(ge,{size:16}):e.jsx(ne,{size:16})}),e.jsx(E,{action:"edit",children:n.status!=="delivered"&&e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>k(null,null,function*(){try{console.log("ðŸšš Truck button clicked for order:",n.id),console.log("ðŸ“¦ Order details:",{id:n.id,date:n.date,status:n.status}),yield B(n.id),c({title:"Order Delivered",description:`Order ${n.id} has been marked as delivered and moved to history.`})}catch(u){console.error("âŒ Mark as delivered failed:",u),c({title:"Error",description:u instanceof Error?u.message:"Failed to mark order as delivered. Please try again.",variant:"destructive"})}}),className:"bg-transparent text-success hover:bg-success/10 hover:text-success",title:"Mark as Delivered",children:e.jsx(ae,{size:16})})}),e.jsx(E,{action:"delete",children:e.jsxs(de,{children:[e.jsx(oe,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"sm",className:"bg-transparent text-destructive hover:bg-destructive/10 hover:text-destructive",title:"Delete Order",children:e.jsx(pe,{size:16})})}),e.jsxs(ie,{className:"bg-background text-foreground","aria-describedby":"delete-order-description",children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Are you sure?"}),e.jsxs(me,{id:"delete-order-description",className:"text-muted-foreground",children:["This action cannot be undone. This will permanently delete order ",n.id,"."]})]}),e.jsxs(xe,{children:[e.jsx(ue,{className:"bg-background text-foreground border-border hover:bg-accent",children:"Cancel"}),e.jsx(he,{onClick:()=>z(n.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})})]})})]},n.id)):e.jsx(K,{children:e.jsx(v,{colSpan:11,className:"text-center text-muted-foreground py-8",children:"No orders for today yet. Create your first order!"})})})]})})]}),e.jsx(Ee,{order:t,open:h,onOpenChange:p})]})}const se=["hsl(232, 90%, 62%)","hsl(280, 85%, 60%)","hsl(340, 82%, 52%)","hsl(25, 95%, 53%)","hsl(48, 96%, 53%)","hsl(142, 71%, 45%)","hsl(199, 89%, 48%)","hsl(271, 81%, 56%)","hsl(355, 78%, 60%)"];function rs(){const{orders:a}=S(),d=a.filter(t=>t.breakdown&&Object.values(t.breakdown).some(i=>i>0)).reduce((t,i)=>(i.breakdown&&Object.entries(i.breakdown).forEach(([h,p])=>{t[h]||(t[h]=0),t[h]+=p||0}),t),{}),s=Object.entries(d).map(([t,i])=>({name:t,value:Math.round(i*100)/100})).filter(t=>t.value>0).sort((t,i)=>parseInt(t.name)-parseInt(i.name)),c=s.reduce((t,i)=>t+i.value,0);return e.jsxs(H,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-4",children:"Steel Breakdown Analytics"}),e.jsx("div",{className:"h-80",children:s.length>0?e.jsx(Ve,{width:"100%",height:"100%",children:e.jsxs(Ue,{children:[e.jsx(Je,{data:s,cx:"50%",cy:"50%",labelLine:!1,label:({name:t,percent:i})=>`${t}: ${(i*100).toFixed(1)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:s.map((t,i)=>e.jsx(qe,{fill:se[i%se.length]},`cell-${i}`))}),e.jsx(He,{contentStyle:{backgroundColor:"hsl(0, 0%, 100%)",border:"1px solid hsl(240, 4%, 80%)",borderRadius:"8px",color:"hsl(0, 0%, 12%)"},formatter:t=>[`${t} tons`,"Total"]})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"No steel breakdown data available"})}),e.jsxs("div",{className:"mt-4 text-sm text-muted-foreground",children:["Active orders steel breakdown: ",c.toFixed(2)," tons total from ",s.length," bar sizes"]})]})}function Ds(){const{loading:a,orders:d}=S();return a&&d.length===0?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading dashboard data..."})]})}):e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx(Qe,{}),e.jsx(Ze,{}),e.jsx(ss,{}),e.jsx(rs,{})]})}export{Ds as Dashboard};
