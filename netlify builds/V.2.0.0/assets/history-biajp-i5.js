var Ce=Object.defineProperty,ke=Object.defineProperties;var Oe=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var Te=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable;var ce=(c,a,o)=>a in c?Ce(c,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):c[a]=o,de=(c,a)=>{for(var o in a||(a={}))Te.call(a,o)&&ce(c,o,a[o]);if(oe)for(var o of oe(a))ze.call(a,o)&&ce(c,o,a[o]);return c},me=(c,a)=>ke(c,Oe(a));var N=(c,a,o)=>new Promise((W,w)=>{var f=p=>{try{O(o.next(p))}catch(T){w(T)}},E=p=>{try{O(o.throw(p))}catch(T){w(T)}},O=p=>p.done?W(p.value):Promise.resolve(p.value).then(f,E);O((o=o.apply(c,a)).next())});import{u as q,a as Be,b as Ee,e as Ae,f as He,g as Me,r as u,j as e,B as b,C as _,I as $e,R as Fe,i as U,d as x,h as C}from"./index-ma71H6Gv.js";import{T as xe,a as he,b as R,c as d,d as ue,e as m}from"./table-J_5NzfFx.js";import{T as Pe,a as Ue,b as Re,c as We}from"./tabs-DCQNEJ-K.js";import{C as Ie,a as Le,b as Ve}from"./collapsible-CkpgzH8I.js";import{E as K,O as Qe}from"./OrderDetailsDialog-DJOUXXC_.js";import{a as S,R as X}from"./RoleBasedComponent-DfoTOiy9.js";import{A as qe}from"./arrow-left-Dq_oDV5o.js";import{S as G}from"./search-DCrcwA4b.js";import{C as k}from"./circle-check-big-ChAZvRIJ.js";import{S as J}from"./square-pen-x80yX958.js";import{C as Ke,e as Xe}from"./select-DIwa_4rP.js";import{C as Ge}from"./calendar-CO-MNXG0.js";import"./dialog-DRm7bkZI.js";import"./CalculatorInput-D0eqxriC.js";import"./calculator-DUrzhYkl.js";import"./weight-1r70IWYE.js";import"./phone-3dYm7qm7.js";import"./index-BHnHYWBN.js";function fs(){const c=q(),{user:a}=Be(),{toast:o}=Ee(),W=Ae();He();const w=Me(),[f,E]=u.useState(""),[O,p]=u.useState(null),[T,Y]=u.useState(!1),[ge,A]=u.useState(!0),[z,H]=u.useState([]),[D,M]=u.useState(!1),[I,Z]=u.useState(""),[g,ee]=u.useState(!1),[fe,pe]=u.useState(new Set),je=s=>{pe(t=>{const r=new Set(t);return r.has(s)?r.delete(s):r.add(s),r})},Ne=s=>fe.has(s);u.useEffect(()=>{let s=!0;return N(null,null,function*(){A(!0);try{c!=null&&c.loadHistoryOrders&&(yield c.loadHistoryOrders())}catch(r){r instanceof Error&&!r.message.includes("message channel closed")&&console.error("Failed to load history orders:",r)}finally{s&&A(!1)}}),()=>{s=!1}},[]);const ye=()=>N(null,null,function*(){try{c!=null&&c.loadHistoryOrders&&(yield c.loadHistoryOrders())}catch(s){console.error("Failed to refresh history:",s)}E(""),H([]),M(!1),ee(!1)}),$=()=>N(null,null,function*(){if(!f.trim()){H([]),M(!1);return}A(!0);try{const s=yield c.searchHistoryOrders(f);H(s),M(!0)}catch(s){console.error("Search failed:",s),o({title:"Search Failed",description:"Could not search orders. Please try again.",variant:"destructive"})}finally{A(!1)}});u.useEffect(()=>{f.trim()||(H([]),M(!1))},[f]);const se=c==null?void 0:c.getDeliveredOrdersByWeek;let y={};try{D||(y=se?se(31):{})}catch(s){console.error("Error getting delivered orders by week:",s),y={}}const ve=s=>{let t=0,r=0;return s.forEach(n=>{const i=(n==null?void 0:n.tons)||0;((n==null?void 0:n.order_type)||"straight-bar")==="cut-and-bend"?r+=i:t+=i}),{straightBar:Math.round(t*100)/100,cutAndBend:Math.round(r*100)/100,total:Math.round((t+r)*100)/100}},be=s=>{const t={};return s.forEach(r=>{const n=r.date;t[n]||(t[n]=[]),t[n].push(r)}),t},Se=s=>{let t=0,r=0;return s.forEach(n=>{const i=(n==null?void 0:n.tons)||0;((n==null?void 0:n.order_type)||"straight-bar")==="cut-and-bend"?r+=i:t+=i}),{straightBar:Math.round(t*100)/100,cutAndBend:Math.round(r*100)/100,total:Math.round((t+r)*100)/100}},j=Object.keys(y).sort((s,t)=>{const r=new Date(s.split("_")[0]);return new Date(t.split("_")[0]).getTime()-r.getTime()});u.useEffect(()=>{j.length>0&&!I&&Z(j[0])},[j.join(","),I]);const we=s=>{try{const[t,r]=s.split("_"),n=new Date(t),i=new Date(r),h={month:"short",day:"numeric"};return`${n.toLocaleDateString("en-US",h)} - ${i.toLocaleDateString("en-US",me(de({},h),{year:"numeric"}))}`}catch(t){return"Invalid Week Range"}},L=s=>{if(!s)return"Invalid Date";try{const t=new Date(s);return isNaN(t.getTime())?"Invalid Date":t.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}catch(t){return"Invalid Date"}},V=s=>e.jsx(x,{className:"bg-success text-success-foreground",children:"Delivered"}),De=s=>s?e.jsxs(x,{className:"bg-success text-success-foreground",children:[e.jsx(k,{size:12,className:"mr-1"}),"Signed"]}):e.jsxs(x,{className:"bg-gray-400 text-white",children:[e.jsx(S,{size:12,className:"mr-1"}),"Not Signed"]}),Q=s=>{console.log("ðŸ” History - Selected order:",s),p(s),Y(!0)},te=()=>D?z.length:g?j.reduce((s,t)=>{var n;const r=((n=y[t])==null?void 0:n.filter(i=>!i.signed_delivery_note))||[];return s+r.length},0):j.reduce((s,t)=>{var r;return s+(((r=y[t])==null?void 0:r.length)||0)},0),re=s=>g?s.filter(t=>!t.signed_delivery_note):s,ae=({order:s,onToggleDeliveryNote:t})=>{var r,n;return e.jsxs(_,{className:"p-4 space-y-3",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-mono font-semibold text-foreground",children:s.delivery_number||s.id}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.customer_name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[V(s.status),e.jsx(b,{variant:"ghost",size:"sm",onClick:i=>{i.stopPropagation(),Q(s)},className:"bg-transparent text-foreground hover:bg-accent hover:text-accent-foreground h-8 w-8 p-0",title:C((r=a==null?void 0:a.profile)==null?void 0:r.role,"edit")?"Edit Order":"View Order",children:C((n=a==null?void 0:a.profile)==null?void 0:n.role,"edit")?e.jsx(J,{size:16}):e.jsx(K,{size:16})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Company:"}),e.jsx("p",{className:"text-foreground font-medium",children:s.company||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Site:"}),e.jsx("p",{className:"text-foreground font-medium",children:s.site||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Tons:"}),e.jsxs("p",{className:"text-foreground font-medium",children:[s.tons," tons"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Shift:"}),e.jsx(x,{className:`${s.shift==="morning"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200"}`,children:s.shift==="morning"?"Morning":"Night"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(X,{action:"edit",fallback:De(s.signed_delivery_note),children:e.jsx("div",{onClick:i=>{i.stopPropagation(),t&&t()},className:"cursor-pointer",title:`Tap to mark as ${s.signed_delivery_note?"not signed":"signed"}`,children:s.signed_delivery_note?e.jsxs(x,{className:"bg-success text-success-foreground cursor-pointer hover:bg-success/80 transition-colors",children:[e.jsx(k,{size:12,className:"mr-1"}),"Signed"]}):e.jsxs(x,{className:"bg-gray-400 text-white cursor-pointer hover:bg-gray-500 transition-colors",children:[e.jsx(S,{size:12,className:"mr-1"}),"Not Signed"]})})})}),s.phone_number?e.jsx("a",{href:`tel:${s.phone_number.replace(/[\s\-\(\)]/g,"")}`,className:"text-sm text-primary hover:text-primary/80 underline",onClick:i=>i.stopPropagation(),children:"Call Driver"}):e.jsx("span",{className:"text-sm text-muted-foreground",children:s.driver_name||"No driver"})]})]})};return e.jsx("div",{className:"space-y-6",children:ge?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading delivery history..."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4",children:[e.jsxs(b,{variant:"ghost",size:"sm",onClick:()=>W("/"),className:"text-foreground hover:bg-accent w-fit",children:[e.jsx(qe,{size:16}),e.jsx("span",{className:"ml-1",children:"Back"})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-headline font-bold text-foreground",children:"Delivery Archive"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:w?"All delivered orders":"Complete historical record of all delivered orders with daily metrics"})]})]}),e.jsx(_,{children:e.jsx("div",{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:16}),e.jsx($e,{id:"history-search",name:"historySearch",placeholder:w?"Search orders...":"Search across entire database (delivery number, name, company...)",value:f,onChange:s=>E(s.target.value),onKeyDown:s=>{s.key==="Enter"&&$()},className:"pl-10 bg-background text-foreground border-border"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(b,{onClick:$,variant:"default",size:"sm",disabled:!f.trim(),className:"text-primary-foreground flex-1 sm:flex-none",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Search"]}),e.jsxs(b,{onClick:ye,variant:"outline",size:"sm",className:"text-foreground border-border hover:bg-accent flex-1 sm:flex-none",children:[e.jsx(Fe,{className:"h-4 w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:D||g?"Clear Filter":"Refresh"})]}),e.jsxs(b,{onClick:()=>ee(!g),variant:g?"default":"outline",size:"sm",className:`flex-1 sm:flex-none ${g?"text-primary-foreground":"text-foreground border-border hover:bg-accent"}`,disabled:D,children:[e.jsx(S,{className:"h-4 w-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:g?"Showing Unsigned":"Show Unsigned Only"}),e.jsx("span",{className:"sm:hidden",children:"Unsigned"})]})]}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground text-center sm:text-left",children:D?`${z.length} results found`:g?`${te()} unsigned orders`:`${te()} orders (past 31 days)`})]})})}),e.jsx("div",{className:"space-y-4",children:D?z.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-foreground",children:['Search Results for "',f,'"']}),e.jsx("div",{className:"md:hidden space-y-3",children:z.map(s=>e.jsx(ae,{order:s,onToggleDeliveryNote:()=>N(null,null,function*(){try{const t=!s.signed_delivery_note;yield U.update(s.id,{signed_delivery_note:t}),yield $(),o({title:"Delivery Note Updated",description:`Delivery note marked as ${t?"signed":"not signed"}.`})}catch(t){console.error("Failed to update delivery note:",t),o({title:"Error",description:"Failed to update delivery note. Please try again.",variant:"destructive"})}})},s.id))}),e.jsx(_,{className:"hidden md:block",children:e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(xe,{children:[e.jsx(he,{children:e.jsxs(R,{className:"border-border",children:[e.jsx(d,{className:"text-foreground",children:"Delivery Number"}),e.jsx(d,{className:"text-foreground",children:"Delivery Name"}),e.jsx(d,{className:"text-foreground",children:"Company"}),e.jsx(d,{className:"text-foreground",children:"Site"}),e.jsx(d,{className:"text-foreground",children:"Date"}),e.jsx(d,{className:"text-foreground",children:"Status"}),e.jsx(d,{className:"text-foreground",children:"Tons"}),e.jsx(d,{className:"text-foreground",children:"Shift"}),e.jsx(d,{className:"text-foreground",children:"Delivery Note"}),e.jsx(d,{className:"text-foreground",children:"Contact"}),e.jsx(d,{className:"text-foreground",children:"Actions"})]})}),e.jsx(ue,{children:z.map(s=>{var t,r;return e.jsxs(R,{className:"border-border hover:bg-muted/50",children:[e.jsx(m,{className:"font-mono text-foreground",children:s.delivery_number||s.id}),e.jsx(m,{className:"text-foreground",children:s.customer_name}),e.jsx(m,{className:"text-foreground",children:s.company||"N/A"}),e.jsx(m,{className:"text-foreground",children:s.site||"N/A"}),e.jsx(m,{className:"text-foreground",children:L(s.date)}),e.jsx(m,{children:V(s.status)}),e.jsxs(m,{className:"text-foreground",children:[s.tons," tons"]}),e.jsx(m,{children:e.jsx(x,{className:s.shift==="morning"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800",children:s.shift==="morning"?"Morning":"Night"})}),e.jsx(m,{children:e.jsx(X,{action:"edit",fallback:s.signed_delivery_note?e.jsxs(x,{className:"bg-success text-success-foreground",children:[e.jsx(k,{size:12,className:"mr-1"}),"Signed"]}):e.jsxs(x,{className:"bg-gray-400 text-white",children:[e.jsx(S,{size:12,className:"mr-1"}),"Not Signed"]}),children:e.jsx("div",{onClick:n=>N(null,null,function*(){n.preventDefault(),n.stopPropagation();try{const i=!s.signed_delivery_note,h={signed_delivery_note:i};yield U.update(s.id,h),yield $(),o({title:"Delivery Note Updated",description:`Delivery note marked as ${i?"signed":"not signed"}.`})}catch(i){console.error("âŒ Failed to update delivery note:",i),o({title:"Error",description:"Failed to update delivery note. Please try again.",variant:"destructive"})}}),className:"cursor-pointer",title:`Click to mark as ${s.signed_delivery_note?"not signed":"signed"}`,children:s.signed_delivery_note?e.jsxs(x,{className:"bg-success text-success-foreground cursor-pointer hover:bg-success/80 transition-colors",children:[e.jsx(k,{size:12,className:"mr-1"}),"Signed"]}):e.jsxs(x,{className:"bg-gray-400 text-white cursor-pointer hover:bg-gray-500 transition-colors",children:[e.jsx(S,{size:12,className:"mr-1"}),"Not Signed"]})})})}),e.jsx(m,{children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-foreground",children:s.driver_name||"N/A"}),s.phone_number?e.jsxs("a",{href:`tel:${s.phone_number.replace(/[\s\-\(\)]/g,"")}`,className:"text-sm text-primary hover:text-primary/80 underline cursor-pointer",title:"Click to call",children:["ðŸ“ž ",s.phone_number]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"-"})]})}),e.jsx(m,{children:e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>Q(s),className:"bg-transparent text-foreground hover:bg-accent hover:text-accent-foreground",title:C((t=a==null?void 0:a.profile)==null?void 0:t.role,"edit")?"Edit Order Details":"View Order Details",children:C((r=a==null?void 0:a.profile)==null?void 0:r.role,"edit")?e.jsx(J,{size:16}):e.jsx(K,{size:16})})})]},s.id)})})]})})})})]}):e.jsx(_,{children:e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(G,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No results found"}),e.jsxs("p",{className:"text-muted-foreground",children:['No orders found matching "',f,'". Try different search terms.']})]})}):j.length>0?e.jsxs(Pe,{value:I,onValueChange:Z,className:"space-y-4",children:[e.jsx(Ue,{className:"w-full justify-start overflow-x-auto flex-nowrap h-auto gap-1 p-1",children:j.map(s=>{const t=re(y[s]),r=ve(t);return g&&t.length===0?null:e.jsxs(Re,{value:s,className:"flex-col items-start px-2 sm:px-4 py-2 h-auto flex-shrink-0 min-w-fit",children:[e.jsx("span",{className:"font-semibold text-xs sm:text-sm",children:we(s)}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.length," orders â€¢ ",r.total,"t"]})]},s)})}),j.map(s=>{const t=re(y[s]);if(g&&t.length===0)return null;const r=be(t),n=Object.keys(r).sort((i,h)=>new Date(h).getTime()-new Date(i).getTime());return e.jsx(We,{value:s,className:"space-y-4",children:n.map(i=>{const h=r[i],ne=Se(h),ie=Ne(i);return e.jsx(Ie,{open:ie,onOpenChange:()=>je(i),children:e.jsxs(_,{children:[e.jsx(Le,{asChild:!0,children:e.jsx("div",{className:"p-3 sm:p-4 cursor-pointer hover:bg-muted/30 transition-colors",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[ie?e.jsx(Ke,{size:20,className:"text-muted-foreground flex-shrink-0"}):e.jsx(Xe,{size:20,className:"text-muted-foreground flex-shrink-0"}),e.jsx("h4",{className:"text-base sm:text-lg font-semibold text-foreground",children:w?L(i).split(",")[0]:L(i)})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4 text-xs sm:text-sm ml-7 sm:ml-0",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsxs("span",{className:"text-foreground",children:["SB: ",e.jsxs("strong",{children:[ne.straightBar,"t"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsxs("span",{className:"text-foreground",children:["C&B: ",e.jsxs("strong",{children:[ne.cutAndBend,"t"]})]})]}),e.jsxs("span",{className:"text-muted-foreground",children:[h.length," orders"]})]})]})})}),e.jsx(Ve,{children:e.jsxs("div",{className:"px-3 pb-3 sm:px-4 sm:pb-4 pt-0 space-y-3 sm:space-y-4 border-t border-border",children:[e.jsx("div",{className:"md:hidden space-y-3 pt-3",children:h.map(l=>e.jsx(ae,{order:l,onToggleDeliveryNote:()=>N(null,null,function*(){try{const v=!l.signed_delivery_note;yield U.update(l.id,{signed_delivery_note:v});const B=q.getState();B.loadHistoryOrders&&(yield B.loadHistoryOrders()),o({title:"Delivery Note Updated",description:`Delivery note marked as ${v?"signed":"not signed"}.`})}catch(v){console.error("Failed to update delivery note:",v),o({title:"Error",description:"Failed to update delivery note. Please try again.",variant:"destructive"})}})},l.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto pt-3",children:e.jsxs(xe,{children:[e.jsx(he,{children:e.jsxs(R,{className:"border-border",children:[e.jsx(d,{className:"text-foreground",children:"Delivery Number"}),e.jsx(d,{className:"text-foreground",children:"Delivery Name"}),e.jsx(d,{className:"text-foreground",children:"Company"}),e.jsx(d,{className:"text-foreground",children:"Site"}),e.jsx(d,{className:"text-foreground",children:"Status"}),e.jsx(d,{className:"text-foreground",children:"Tons"}),e.jsx(d,{className:"text-foreground",children:"Shift"}),e.jsx(d,{className:"text-foreground",children:"Delivery Note"}),e.jsx(d,{className:"text-foreground",children:"Contact"}),e.jsx(d,{className:"text-foreground",children:"Actions"})]})}),e.jsx(ue,{children:h.map(l=>{var v,B;return e.jsxs(R,{className:"border-border hover:bg-muted/50",children:[e.jsx(m,{className:"font-mono text-foreground",children:l.delivery_number||l.id}),e.jsx(m,{className:"text-foreground",children:l.customer_name}),e.jsx(m,{className:"text-foreground",children:l.company||"N/A"}),e.jsx(m,{className:"text-foreground",children:l.site||"N/A"}),e.jsx(m,{children:V(l.status)}),e.jsxs(m,{className:"text-foreground",children:[l.tons," tons"]}),e.jsx(m,{children:e.jsx(x,{className:l.shift==="morning"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800",children:l.shift==="morning"?"Morning":"Night"})}),e.jsx(m,{children:e.jsx(X,{action:"edit",fallback:l.signed_delivery_note?e.jsxs(x,{className:"bg-success text-success-foreground",children:[e.jsx(k,{size:12,className:"mr-1"}),"Signed"]}):e.jsxs(x,{className:"bg-gray-400 text-white",children:[e.jsx(S,{size:12,className:"mr-1"}),"Not Signed"]}),children:e.jsx("div",{onClick:F=>N(null,null,function*(){F.preventDefault(),F.stopPropagation();try{console.log("ðŸ”„ Toggling delivery note for history order:",l.id),console.log("ðŸ“‹ Current status:",l.signed_delivery_note);const P=!l.signed_delivery_note,_e={signed_delivery_note:P};yield U.update(l.id,_e);const le=q.getState();le.loadHistoryOrders&&(yield le.loadHistoryOrders()),o({title:"Delivery Note Updated",description:`Delivery note marked as ${P?"signed":"not signed"}.`})}catch(P){console.error("âŒ Failed to update delivery note:",P),o({title:"Error",description:"Failed to update delivery note. Please try again.",variant:"destructive"})}}),className:"cursor-pointer",title:`Click to mark as ${l.signed_delivery_note?"not signed":"signed"}`,children:l.signed_delivery_note?e.jsxs(x,{className:"bg-success text-success-foreground cursor-pointer hover:bg-success/80 transition-colors",children:[e.jsx(k,{size:12,className:"mr-1"}),"Signed"]}):e.jsxs(x,{className:"bg-gray-400 text-white cursor-pointer hover:bg-gray-500 transition-colors",children:[e.jsx(S,{size:12,className:"mr-1"}),"Not Signed"]})})})}),e.jsx(m,{children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-foreground",children:l.driver_name||"N/A"}),l.phone_number?e.jsxs("a",{href:`tel:${l.phone_number.replace(/[\s\-\(\)]/g,"")}`,className:"text-sm text-primary hover:text-primary/80 underline cursor-pointer",title:"Click to call",children:["ðŸ“ž ",l.phone_number]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"-"})]})}),e.jsx(m,{children:e.jsx(b,{variant:"ghost",size:"sm",onClick:F=>{F.stopPropagation(),Q(l)},className:"bg-transparent text-foreground hover:bg-accent hover:text-accent-foreground",title:C((v=a==null?void 0:a.profile)==null?void 0:v.role,"edit")?"Edit Order Details":"View Order Details",children:C((B=a==null?void 0:a.profile)==null?void 0:B.role,"edit")?e.jsx(J,{size:16}):e.jsx(K,{size:16})})})]},l.id)})})]})})]})})]})},i)})},s)})]}):e.jsx(_,{children:e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(Ge,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No delivered orders found"}),e.jsx("p",{className:"text-muted-foreground",children:"No delivered orders in the past 31 days."})]})})}),e.jsx(Qe,{order:O,open:T,onOpenChange:Y})]})})}export{fs as History};
