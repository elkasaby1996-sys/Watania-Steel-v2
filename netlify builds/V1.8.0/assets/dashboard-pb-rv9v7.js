const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/driversStore-CtgkP15o.js","assets/index-DrtJc57V.js","assets/index-BbPQ_6WP.css"])))=>i.map(i=>d[i]);
var de=Object.defineProperty,ne=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var ee=(o,n,r)=>n in o?de(o,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[n]=r,y=(o,n)=>{for(var r in n||(n={}))le.call(n,r)&&ee(o,r,n[r]);if(Z)for(var r of Z(n))ce.call(n,r)&&ee(o,r,n[r]);return o},D=(o,n)=>ne(o,ie(n));var O=(o,n,r)=>new Promise((i,a)=>{var j=m=>{try{f(r.next(m))}catch(N){a(N)}},C=m=>{try{f(r.throw(m))}catch(N){a(N)}},f=m=>m.done?i(m.value):Promise.resolve(m.value).then(j,C);f((r=r.apply(o,n)).next())});import{c as se,r as k,u as A,a as Y,b as te,h as W,j as e,B as F,L as x,I as T,_ as me,T as ue,C as G,d as p,o as xe,e as ge,R as he}from"./index-DrtJc57V.js";import{D as pe,a as be,b as Ne,c as ve,d as je}from"./dialog-b53tw_S6.js";import{S as I,a as M,b as R,c as q,d as w}from"./select-Ckbz379H.js";import{C as fe,R as z,a as re}from"./RoleBasedComponent-VZo09JCK.js";import{S as ae,E as ye,O as De}from"./OrderDetailsDialog-o2doORZU.js";import{C as we}from"./CalculatorInput-BNKdttAW.js";import{P as ke}from"./plus-CO6meFXO.js";import{P as X}from"./weight-hWzbXMLY.js";import{C as Ce}from"./phone-8MZzO7QX.js";import{C as L}from"./circle-check-big-BN38TGIK.js";import{T as Se,a as Oe,b as U,c as b,d as Te,e as h}from"./table-BVAkCOaz.js";import{A as Fe,a as Ae,b as $e,c as Pe,d as Be,e as Ee,f as _e,g as Ie,h as Me}from"./alert-dialog-B1Gotw7d.js";import{S as Re}from"./square-pen-G00cnQUb.js";import{T as qe}from"./trash-2-KzDNDGP3.js";import"./index-C8j-8XsM.js";import"./calendar-CePNJWhY.js";import"./calculator-ChZ83Mfv.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"M5 12h14",key:"1ays0h"}]],Le=se("minus",ze);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]],He=se("scissors",Ve);function Je(){var Q;const[o,n]=k.useState(!1),[r,i]=k.useState({deliveryNumber:"",deliveryName:"",company:"",site:"",driverName:"none",phoneNumber:"",status:"in-progress",tons:"",shift:"morning",signedDeliveryNote:!1,orderType:"straight-bar",orderDate:new Date().toISOString().split("T")[0],breakdown:{"8mm":"","10mm":"","12mm":"","14mm":"","16mm":"","18mm":"","20mm":"","25mm":"","32mm":""}}),[a,j]=k.useState({}),[C,f]=k.useState(!1),{addOrder:m}=A(),{user:N}=Y(),{toast:$}=te(),[E,P]=k.useState([]);k.useEffect(()=>{o&&O(null,null,function*(){try{const{useDriversStore:l}=yield me(()=>O(null,null,function*(){const{useDriversStore:S}=yield import("./driversStore-CtgkP15o.js");return{useDriversStore:S}}),__vite__mapDeps([0,1,2])),{loadDrivers:c,getActiveDrivers:v}=l.getState();yield c();const g=v();P(g)}catch(l){console.error("Failed to load drivers:",l),P([])}})},[o]);const _=W((Q=N==null?void 0:N.profile)==null?void 0:Q.role,"create"),B=()=>Object.values(r.breakdown).reduce((s,l)=>{const c=parseFloat(l)||0;return s+c},0),t=()=>{const s={};(!r.deliveryNumber||r.deliveryNumber.trim()==="")&&(s.deliveryNumber="Delivery number is required"),(!r.deliveryName||r.deliveryName.trim()==="")&&(s.deliveryName="Delivery name is required"),(!r.company||r.company.trim()==="")&&(s.company="Company is required"),(!r.site||r.site.trim()==="")&&(s.site="Site is required"),(!r.orderDate||r.orderDate.trim()==="")&&(s.orderDate="Order date is required"),r.phoneNumber&&r.phoneNumber.trim()!==""&&!/^\+?[\d\s\-\(\)]+$/.test(r.phoneNumber)&&(s.phoneNumber="Please enter a valid phone number");const l=B(),c=parseFloat(r.tons)||0;!r.tons||r.tons.trim()===""?s.tons="Total tons is required":isNaN(Number(r.tons))||Number(r.tons)<=0?s.tons="Please enter a valid number of tons":l>0&&Math.abs(l-c)>.1&&(s.tons=`Total tons (${c}) doesn't match breakdown total (${l.toFixed(2)})`);const{orders:v,historyOrders:g}=A.getState(),S=r.deliveryNumber,H=v.find(J=>J.id===S),oe=g.find(J=>J.id===S);return(H||oe)&&(s.deliveryNumber=`Delivery number "${S}" already exists`),j(s),Object.keys(s).length===0},u=s=>O(null,null,function*(){if(s.preventDefault(),!_){$({title:"Access Denied",description:"You don't have permission to create orders. Contact your administrator.",variant:"destructive"});return}if(t())try{const l=r.deliveryNumber,c=Number(r.tons),v=c*100,g={id:l,customerName:r.deliveryName,date:new Date().toISOString().split("T")[0],status:r.status,amount:v,tons:c,shift:r.shift,deliveryNumber:r.deliveryNumber,company:r.company||"",site:r.site||"",driverName:r.driverName==="none"?"":r.driverName||"",phoneNumber:r.phoneNumber||"",signedDeliveryNote:r.signedDeliveryNote,orderType:r.orderType,breakdown:{"8mm":parseFloat(r.breakdown["8mm"])||0,"10mm":parseFloat(r.breakdown["10mm"])||0,"12mm":parseFloat(r.breakdown["12mm"])||0,"14mm":parseFloat(r.breakdown["14mm"])||0,"16mm":parseFloat(r.breakdown["16mm"])||0,"18mm":parseFloat(r.breakdown["18mm"])||0,"20mm":parseFloat(r.breakdown["20mm"])||0,"25mm":parseFloat(r.breakdown["25mm"])||0,"32mm":parseFloat(r.breakdown["32mm"])||0}};yield m(g),$({title:"Order Created",description:`Order ${l} has been successfully created.`}),i({deliveryNumber:"",deliveryName:"",company:"",site:"",driverName:"none",phoneNumber:"",status:"in-progress",tons:"",shift:"morning",signedDeliveryNote:!1,orderType:"straight-bar",breakdown:{"8mm":"","10mm":"","12mm":"","14mm":"","16mm":"","18mm":"","20mm":"","25mm":"","32mm":""}}),j({}),n(!1)}catch(l){console.error("Order creation failed:",l),$({title:"Error",description:l instanceof Error?l.message:"Failed to create order. Please try again.",variant:"destructive"})}}),d=(s,l)=>{i(c=>D(y({},c),{[s]:l})),a[s]&&j(c=>D(y({},c),{[s]:void 0}))},V=(s,l)=>{i(g=>D(y({},g),{breakdown:D(y({},g.breakdown),{[s]:l})}));const c=D(y({},r.breakdown),{[s]:l}),v=Object.values(c).reduce((g,S)=>{const H=parseFloat(S)||0;return g+H},0);v>0&&i(g=>D(y({},g),{tons:v.toFixed(2)}))},K=s=>{n(s),s||(i({deliveryNumber:"",deliveryName:"",company:"",site:"",driverName:"none",phoneNumber:"",status:"in-progress",tons:"",shift:"morning",signedDeliveryNote:!1,orderType:"straight-bar",orderDate:new Date().toISOString().split("T")[0],breakdown:{"8mm":"","10mm":"","12mm":"","14mm":"","16mm":"","18mm":"","20mm":"","25mm":"","32mm":""}}),j({}),f(!1),P([]))};return _?e.jsxs(pe,{open:o,onOpenChange:K,children:[e.jsx(be,{asChild:!0,children:e.jsxs(F,{className:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-md",children:[e.jsx(ke,{size:20}),e.jsx("span",{className:"font-medium",children:"Add New Order"})]})}),e.jsxs(Ne,{className:"sm:max-w-[700px] bg-background text-foreground max-h-[90vh] overflow-y-auto",children:[e.jsx(ve,{children:e.jsx(je,{className:"text-foreground",children:"Create New Order"})}),e.jsxs("form",{onSubmit:u,className:"space-y-6",id:"add-order-form",onReset:()=>{console.log("ðŸ”„ Form reset triggered"),j({}),f(!1)},children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-deliveryNumber",className:"text-foreground",children:"Delivery Number * (Can include letters, numbers, special characters)"}),e.jsx(T,{id:"add-deliveryNumber",name:"deliveryNumber",value:r.deliveryNumber,onChange:s=>d("deliveryNumber",s.target.value),placeholder:"Enter any delivery number (e.g., DEL-001, PROJ-2024-ABC, etc.)",className:`bg-background text-foreground border-border ${a.deliveryNumber?"border-destructive":""}`}),a.deliveryNumber&&e.jsx("p",{className:"text-sm text-destructive",children:a.deliveryNumber})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-deliveryName",className:"text-foreground",children:"Delivery Name *"}),e.jsx(T,{id:"add-deliveryName",name:"deliveryName",value:r.deliveryName,onChange:s=>d("deliveryName",s.target.value),placeholder:"John Smith",className:`bg-background text-foreground border-border ${a.deliveryName?"border-destructive":""}`}),a.deliveryName&&e.jsx("p",{className:"text-sm text-destructive",children:a.deliveryName})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-company",className:"text-foreground",children:"Company *"}),e.jsx(T,{id:"add-company",name:"company",value:r.company,onChange:s=>d("company",s.target.value),placeholder:"Acme Corporation",className:`bg-background text-foreground border-border ${a.company?"border-destructive":""}`}),a.company&&e.jsx("p",{className:"text-sm text-destructive",children:a.company})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-site",className:"text-foreground",children:"Site *"}),e.jsx(T,{id:"add-site",name:"site",value:r.site,onChange:s=>d("site",s.target.value),placeholder:"Main Warehouse - Building A",className:`bg-background text-foreground border-border ${a.site?"border-destructive":""}`}),a.site&&e.jsx("p",{className:"text-sm text-destructive",children:a.site})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-driverName",className:"text-foreground",children:"Driver Name"}),e.jsxs(I,{name:"driverName",value:r.driverName,onValueChange:s=>{if(d("driverName",s==="none"?"":s),s!=="none"){const c=E.find(v=>v.name===s);c&&d("phoneNumber",c.phone_number)}else d("phoneNumber","")},children:[e.jsx(M,{id:"add-driverName",className:"bg-background text-foreground border-border",children:e.jsx(R,{placeholder:"Select driver (optional)"})}),e.jsxs(q,{className:"bg-popover text-popover-foreground",children:[e.jsx(w,{value:"none",children:"No driver assigned"}),E.map(s=>e.jsx(w,{value:s.name,children:s.name},s.id))]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select from active drivers or leave empty"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-phoneNumber",className:"text-foreground",children:"Phone Number"}),e.jsx(T,{id:"add-phoneNumber",name:"phoneNumber",value:r.phoneNumber,onChange:s=>d("phoneNumber",s.target.value),placeholder:"+1 (555) 123-4567 (optional)",className:`bg-background text-foreground border-border ${a.phoneNumber?"border-destructive":""}`}),a.phoneNumber&&e.jsx("p",{className:"text-sm text-destructive",children:a.phoneNumber}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Can be updated later"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-order-date",className:"text-foreground",children:"Order Date *"}),e.jsx(T,{id:"add-order-date",name:"orderDate",type:"date",value:r.orderDate,onChange:s=>d("orderDate",s.target.value),className:`bg-background text-foreground border-border ${a.orderDate?"border-destructive":""}`}),a.orderDate&&e.jsx("p",{className:"text-sm text-destructive",children:a.orderDate})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-tons",className:"text-foreground",children:"Total Tons *"}),e.jsx(T,{id:"add-tons",name:"tons",type:"number",step:"0.1",value:r.tons,onChange:s=>d("tons",s.target.value),placeholder:"12.5",className:`bg-background text-foreground border-border ${a.tons?"border-destructive":""}`}),a.tons&&e.jsx("p",{className:"text-sm text-destructive",children:a.tons})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-shift",className:"text-foreground",children:"Shift"}),e.jsxs(I,{name:"shift",value:r.shift,onValueChange:s=>d("shift",s),children:[e.jsx(M,{id:"add-shift",className:"bg-background text-foreground border-border",children:e.jsx(R,{placeholder:"Select shift"})}),e.jsxs(q,{className:"bg-popover text-popover-foreground",children:[e.jsx(w,{value:"morning",children:"Morning Shift"}),e.jsx(w,{value:"night",children:"Night Shift"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-orderType",className:"text-foreground",children:"Order Type *"}),e.jsxs(I,{name:"orderType",value:r.orderType,onValueChange:s=>d("orderType",s),children:[e.jsx(M,{id:"add-orderType",className:"bg-background text-foreground border-border",children:e.jsx(R,{placeholder:"Select order type"})}),e.jsxs(q,{className:"bg-popover text-popover-foreground",children:[e.jsx(w,{value:"straight-bar",children:"Straight Bar"}),e.jsx(w,{value:"cut-and-bend",children:"Cut and Bend"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-status",className:"text-foreground",children:"Order Status"}),e.jsxs(I,{name:"status",value:r.status,onValueChange:s=>d("status",s),children:[e.jsx(M,{id:"add-status",className:"bg-background text-foreground border-border",children:e.jsx(R,{placeholder:"Select status"})}),e.jsxs(q,{className:"bg-popover text-popover-foreground",children:[e.jsx(w,{value:"in-progress",children:"In Progress"}),e.jsx(w,{value:"delivered",children:"Delivered"})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fe,{id:"add-signedDeliveryNote",checked:r.signedDeliveryNote,onCheckedChange:s=>d("signedDeliveryNote",s)}),e.jsx(x,{htmlFor:"add-signedDeliveryNote",className:"text-foreground",children:"Signed Delivery Note Received"})]}),e.jsx(ae,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-foreground",children:"Steel Breakdown (Tons)"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Total: ",B().toFixed(2)," tons"]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:Object.entries(r.breakdown).map(([s,l])=>e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{htmlFor:`breakdown-${s}`,className:"text-xs text-foreground",children:s}),e.jsx(we,{id:`breakdown-${s}`,name:`breakdown-${s}`,value:l,onChange:c=>V(s,c),placeholder:"0.0 or =10+5",className:"bg-background text-foreground border-border text-sm h-8",step:"0.1"})]},s))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'Enter tonnage for each steel bar size. Start with "=" for calculations (e.g., =10+5).'})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(F,{type:"button",variant:"outline",onClick:()=>K(!1),className:"bg-background text-foreground border-border hover:bg-accent hover:text-accent-foreground",disabled:C,children:"Cancel"}),e.jsx(F,{type:"submit",className:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-md",disabled:C,children:C?"Creating...":"Create Order"})]})]})]})]}):null}function Ue(){const{user:o}=Y(),n=new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});return e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-headline font-bold text-foreground mb-2",children:"Al Watania Steel - Daily Orders"}),e.jsxs("p",{className:"text-muted-foreground",children:[n," - Track and manage steel deliveries"]})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx(z,{action:"create",children:e.jsx(Je,{})})})]})})}function We(){const{stats:o}=A(),n=[{title:"Cut & Bend",value:`${o.cutAndBend} tons`,icon:He,color:"text-purple-600",bgColor:"bg-purple-100"},{title:"Straight Bar",value:`${o.straightBar} tons`,icon:Le,color:"text-blue-600",bgColor:"bg-blue-100"},{title:"Today's Orders",value:o.todayOrders,icon:X,color:"text-primary",bgColor:"bg-primary/10"},{title:"In Progress",value:o.inProgress,icon:Ce,color:"text-tertiary",bgColor:"bg-tertiary/10"},{title:"Completed",value:o.completed,icon:L,color:"text-success",bgColor:"bg-success/10"},{title:"Delayed",value:o.delayed,icon:ue,color:"text-warning",bgColor:"bg-warning/10"}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6",children:n.map((r,i)=>e.jsx(G,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:r.title}),e.jsx("p",{className:"text-3xl font-bold text-foreground",children:r.value})]}),e.jsx("div",{className:`p-3 rounded-lg ${r.bgColor}`,children:e.jsx(r.icon,{className:`h-6 w-6 ${r.color}`})})]})},i))})}function Xe(){var B;const{getFilteredTodayOrders:o,deleteOrder:n}=A(),{user:r}=Y(),{toast:i}=te(),[a,j]=k.useState(null),[C,f]=k.useState(!1),m=o(),N=(B=r==null?void 0:r.profile)==null?void 0:B.role,$=t=>{switch(t){case"completed":return e.jsx(p,{className:"bg-success text-success-foreground",children:"Completed"});case"in-progress":return e.jsx(p,{className:"bg-tertiary text-tertiary-foreground",children:"In Progress"});case"delayed":return e.jsx(p,{className:"bg-warning text-warning-foreground",children:"Delayed"});case"pending":return e.jsx(p,{className:"bg-gray-400 text-white",children:"Pending"});case"delivered":return e.jsx(p,{className:"bg-green-600 text-white",children:"Delivered"});default:return e.jsx(p,{className:"bg-gray-400 text-white",children:t})}},E=t=>O(null,null,function*(){console.log("ðŸšš Truck button clicked for order:",t);const u=m.find(d=>d.id===t);if(!u)throw new Error("Order not found");console.log("ðŸ“¦ Order details:",{id:u.id,date:u.date,status:u.status});try{const{markAsDelivered:d}=A.getState();yield d(t),console.log("âœ… Order moved to history successfully")}catch(d){throw console.error("âŒ Failed to move order to history:",d),d}}),P=t=>{console.log("ðŸ” OrderTable - Selected order:",t),alert(`Debug: Order data = ${JSON.stringify({id:t.id,orderType:t.orderType,signedDeliveryNote:t.signedDeliveryNote,breakdown:t.breakdown},null,2)}`),j(t),f(!0)},_=t=>{n(t),i({title:"Order Deleted",description:`Order ${t} has been successfully deleted.`})};return e.jsxs(G,{children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Today's Orders"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[m.length," active orders"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Se,{children:[e.jsx(Oe,{children:e.jsxs(U,{className:"border-border",children:[e.jsx(b,{className:"text-foreground",children:"Delivery Number"}),e.jsx(b,{className:"text-foreground",children:"Delivery Name"}),e.jsx(b,{className:"text-foreground",children:"Company"}),e.jsx(b,{className:"text-foreground",children:"Site"}),e.jsx(b,{className:"text-foreground",children:"Date"}),e.jsx(b,{className:"text-foreground",children:"Status"}),e.jsx(b,{className:"text-foreground",children:"Tons"}),e.jsx(b,{className:"text-foreground",children:"Shift"}),e.jsx(b,{className:"text-foreground",children:"Delivery Note"}),e.jsx(b,{className:"text-foreground",children:"Contact"}),e.jsx(b,{className:"text-foreground",children:"Actions"})]})}),e.jsx(Te,{children:m.length>0?m.map(t=>e.jsxs(U,{className:"border-border hover:bg-muted/50",children:[e.jsx(h,{className:"font-mono text-foreground",children:t.id}),e.jsx(h,{className:"text-foreground",children:t.customerName}),e.jsx(h,{className:"text-foreground",children:t.company||"N/A"}),e.jsx(h,{className:"text-foreground",children:t.site||"N/A"}),e.jsx(h,{className:"text-foreground",children:t.date}),e.jsx(h,{children:$(t.status)}),e.jsxs(h,{className:"text-foreground",children:[t.tons," tons"]}),e.jsx(h,{children:e.jsx(p,{className:t.shift==="morning"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800",children:t.shift==="morning"?"Morning":"Night"})}),e.jsx(h,{children:e.jsx(z,{action:"edit",fallback:t.signedDeliveryNote?e.jsxs(p,{className:"bg-success text-success-foreground",children:[e.jsx(L,{size:12,className:"mr-1"}),"Signed"]}):e.jsxs(p,{className:"bg-gray-400 text-white",children:[e.jsx(re,{size:12,className:"mr-1"}),"Not Signed"]}),children:e.jsx(F,{variant:"ghost",size:"sm",onClick:()=>O(null,null,function*(){try{const u=D(y({},t),{signedDeliveryNote:newStatus}),d=A.getState();if(d.updateOrder)yield d.updateOrder(u);else{const V={signed_delivery_note:newStatus};yield xe.update(t.id,V),d.loadOrders&&(yield d.loadOrders())}i({title:"Delivery Note Updated",description:`Delivery note marked as ${t.signedDeliveryNote?"not signed":"signed"}.`})}catch(u){console.error("Failed to update delivery note:",u),i({title:"Error",description:"Failed to update delivery note. Please try again.",variant:"destructive"})}}),className:"p-0 h-auto hover:bg-transparent",title:`Click to mark as ${t.signedDeliveryNote?"not signed":"signed"}`,children:t.signedDeliveryNote?e.jsxs(p,{className:"bg-success text-success-foreground cursor-pointer hover:bg-success/80 transition-colors",children:[e.jsx(L,{size:12,className:"mr-1"}),"Signed"]}):e.jsxs(p,{className:"bg-gray-400 text-white cursor-pointer hover:bg-gray-500 transition-colors",children:[e.jsx(re,{size:12,className:"mr-1"}),"Not Signed"]})})})}),e.jsx(h,{children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-foreground",children:t.driverName||"N/A"}),t.phoneNumber?e.jsxs("a",{href:`tel:${t.phoneNumber.replace(/[\s\-\(\)]/g,"")}`,className:"text-sm text-primary hover:text-primary/80 underline cursor-pointer",title:"Click to call",children:["ðŸ“ž ",t.phoneNumber]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"-"})]})}),e.jsx(h,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{variant:"ghost",size:"sm",onClick:()=>P(t),className:"bg-transparent text-foreground hover:bg-accent hover:text-accent-foreground",title:W(N,"edit")?"Edit Order Details":"View Order Details",children:W(N,"edit")?e.jsx(Re,{size:16}):e.jsx(ye,{size:16})}),e.jsx(z,{action:"edit",children:t.status!=="delivered"&&e.jsx(F,{variant:"ghost",size:"sm",onClick:()=>O(null,null,function*(){try{console.log("ðŸšš Truck button clicked for order:",t.id),console.log("ðŸ“¦ Order details:",{id:t.id,date:t.date,status:t.status}),yield E(t.id),i({title:"Order Delivered",description:`Order ${t.id} has been marked as delivered and moved to history.`})}catch(u){console.error("âŒ Mark as delivered failed:",u),i({title:"Error",description:u instanceof Error?u.message:"Failed to mark order as delivered. Please try again.",variant:"destructive"})}}),className:"bg-transparent text-success hover:bg-success/10 hover:text-success",title:"Mark as Delivered",children:e.jsx(ge,{size:16})})}),e.jsx(z,{action:"delete",children:e.jsxs(Fe,{children:[e.jsx(Ae,{asChild:!0,children:e.jsx(F,{variant:"ghost",size:"sm",className:"bg-transparent text-destructive hover:bg-destructive/10 hover:text-destructive",title:"Delete Order",children:e.jsx(qe,{size:16})})}),e.jsxs($e,{className:"bg-background text-foreground","aria-describedby":"delete-order-description",children:[e.jsxs(Pe,{children:[e.jsx(Be,{children:"Are you sure?"}),e.jsxs(Ee,{id:"delete-order-description",className:"text-muted-foreground",children:["This action cannot be undone. This will permanently delete order ",t.id,"."]})]}),e.jsxs(_e,{children:[e.jsx(Ie,{className:"bg-background text-foreground border-border hover:bg-accent",children:"Cancel"}),e.jsx(Me,{onClick:()=>_(t.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})})]})})]},t.id)):e.jsx(U,{children:e.jsx(h,{colSpan:11,className:"text-center text-muted-foreground py-8",children:"No orders for today yet. Create your first order!"})})})]})})]}),e.jsx(De,{order:a,open:C,onOpenChange:f})]})}function Ye(){const{activities:o}=A(),n=i=>{switch(i){case"order_created":return e.jsx(X,{className:"h-4 w-4 text-primary"});case"order_updated":return e.jsx(he,{className:"h-4 w-4 text-tertiary"});case"order_completed":return e.jsx(L,{className:"h-4 w-4 text-success"});default:return e.jsx(X,{className:"h-4 w-4 text-primary"})}},r=i=>new Date(i).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});return e.jsxs(G,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-4",children:"Activity Feed"}),e.jsx("div",{className:"space-y-4",children:o.map((i,a)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1",children:n(i.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-foreground",children:i.message}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r(i.timestamp)})]})]}),a<o.length-1&&e.jsx(ae,{className:"my-4 bg-border"})]},i.id))})]})}function gr(){return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ue,{}),e.jsx(We,{}),e.jsx(Xe,{}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx(Ye,{})})]})}export{gr as Dashboard};
