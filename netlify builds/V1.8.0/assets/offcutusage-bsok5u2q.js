var Se=Object.defineProperty,ke=Object.defineProperties;var Ee=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var se=(t,l,a)=>l in t?Se(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a,C=(t,l)=>{for(var a in l||(l={}))te.call(l,a)&&se(t,a,l[a]);if(H)for(var a of H(l))ae.call(l,a)&&se(t,a,l[a]);return t},_=(t,l)=>ke(t,Ee(l));var U=(t,l)=>{var a={};for(var r in t)te.call(t,r)&&l.indexOf(r)<0&&(a[r]=t[r]);if(t!=null&&H)for(var r of H(t))l.indexOf(r)<0&&ae.call(t,r)&&(a[r]=t[r]);return a};var M=(t,l,a)=>new Promise((r,n)=>{var m=o=>{try{v(a.next(o))}catch(i){n(i)}},f=o=>{try{v(a.throw(o))}catch(i){n(i)}},v=o=>o.done?r(o.value):Promise.resolve(o.value).then(m,f);v((a=a.apply(t,l)).next())});import{c as he,r as d,A as Fe,j as e,w as Ae,M as Pe,P as q,x as Re,D as Le,v as $e,N as Oe,b as xe,O as $,B as R,L as I,I as L,a as ue,h as X,d as Y,F as Ie,X as Me,C as S,n as k,p as P,m as A}from"./index-DrtJc57V.js";import{T as Be,a as Ve,b as ie}from"./tabs-CN9L1hSb.js";import{D as Ue,b as ze,c as We,d as Ge,i as He}from"./dialog-b53tw_S6.js";import{S as ne,a as re,b as le,c as oe,d as K,C as Ke}from"./select-Ckbz379H.js";import{C as ce}from"./CalculatorInput-BNKdttAW.js";import{T as pe}from"./trash-2-KzDNDGP3.js";import{P as ge}from"./plus-CO6meFXO.js";import{S as Xe}from"./save-BJ2QkU2u.js";import{T as je,a as fe,b as z,c as D,d as ve,e as y}from"./table-BVAkCOaz.js";import{P as qe,W as Ye}from"./weight-hWzbXMLY.js";import{T as Je}from"./trending-up-MJhvXpWp.js";import{B as Qe,K as Ne,X as be,Y as ye,F as Ze,R as es,I as ss,J as ts}from"./generateCategoricalChart-Celw9QEy.js";import{C as as}from"./calendar-CePNJWhY.js";import"./index-C8j-8XsM.js";import"./calculator-ChZ83Mfv.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],ns=he("award",is);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],ls=he("pencil",rs);var os=Qe({chartName:"BarChart",GraphicalChild:Ne,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:be},{axisType:"yAxis",AxisComp:ye}],formatAxisMap:Ze}),J="Collapsible",[cs]=Ae(J),[ds,Q]=cs(J),we=d.forwardRef((t,l)=>{const j=t,{__scopeCollapsible:a,open:r,defaultOpen:n,disabled:m,onOpenChange:f}=j,v=U(j,["__scopeCollapsible","open","defaultOpen","disabled","onOpenChange"]),[o=!1,i]=Fe({prop:r,defaultProp:n,onChange:f});return e.jsx(ds,{scope:a,disabled:m,contentId:Pe(),open:o,onOpenToggle:d.useCallback(()=>i(u=>!u),[i]),children:e.jsx(q.div,_(C({"data-state":ee(o),"data-disabled":m?"":void 0},v),{ref:l}))})});we.displayName=J;var Ce="CollapsibleTrigger",Te=d.forwardRef((t,l)=>{const m=t,{__scopeCollapsible:a}=m,r=U(m,["__scopeCollapsible"]),n=Q(Ce,a);return e.jsx(q.button,_(C({type:"button","aria-controls":n.contentId,"aria-expanded":n.open||!1,"data-state":ee(n.open),"data-disabled":n.disabled?"":void 0,disabled:n.disabled},r),{ref:l,onClick:Re(t.onClick,n.onOpenToggle)}))});Te.displayName=Ce;var Z="CollapsibleContent",_e=d.forwardRef((t,l)=>{const m=t,{forceMount:a}=m,r=U(m,["forceMount"]),n=Q(Z,t.__scopeCollapsible);return e.jsx(Le,{present:a||n.open,children:({present:f})=>e.jsx(ms,_(C({},r),{ref:l,present:f}))})});_e.displayName=Z;var ms=d.forwardRef((t,l)=>{const N=t,{__scopeCollapsible:a,present:r,children:n}=N,m=U(N,["__scopeCollapsible","present","children"]),f=Q(Z,a),[v,o]=d.useState(r),i=d.useRef(null),j=$e(l,i),u=d.useRef(0),x=u.current,w=d.useRef(0),E=w.current,F=f.open||v,c=d.useRef(F),p=d.useRef();return d.useEffect(()=>{const b=requestAnimationFrame(()=>c.current=!1);return()=>cancelAnimationFrame(b)},[]),Oe(()=>{const b=i.current;if(b){p.current=p.current||{transitionDuration:b.style.transitionDuration,animationName:b.style.animationName},b.style.transitionDuration="0s",b.style.animationName="none";const O=b.getBoundingClientRect();u.current=O.height,w.current=O.width,c.current||(b.style.transitionDuration=p.current.transitionDuration,b.style.animationName=p.current.animationName),o(r)}},[f.open,r]),e.jsx(q.div,_(C({"data-state":ee(f.open),"data-disabled":f.disabled?"":void 0,id:f.contentId,hidden:!F},m),{ref:j,style:C({"--radix-collapsible-content-height":x?`${x}px`:void 0,"--radix-collapsible-content-width":E?`${E}px`:void 0},t.style),children:F&&n}))});function ee(t){return t?"open":"closed"}var hs=we;const xs=hs,us=Te,ps=_e,gs=["8mm","10mm","12mm","14mm","16mm","18mm","20mm","25mm","32mm"];function js({open:t,onOpenChange:l,selectedDate:a,onEntriesAdded:r}){const[n,m]=d.useState([]),[f,v]=d.useState([]),[o,i]=d.useState(!1),[j,u]=d.useState(!1),{toast:x}=xe();d.useEffect(()=>{t&&(m([w()]),E())},[t,a]);const w=()=>({id:`temp-${Date.now()}-${Math.random()}`,date:a,company:"",bar_diameter:"",pieces_used:"",weight_kg:"",notes:""}),E=()=>M(null,null,function*(){i(!0);try{const s=yield $.getCompaniesForDate(a);v(s)}catch(s){console.error("Failed to load companies:",s),x({title:"Error",description:"Failed to load companies. Please try again.",variant:"destructive"})}finally{i(!1)}}),F=()=>{m([...n,w()])},c=s=>{if(n.length===1){x({title:"Cannot remove",description:"At least one entry is required",variant:"destructive"});return}m(n.filter(h=>h.id!==s))},p=(s,h,g)=>{m(n.map(T=>T.id===s?_(C({},T),{[h]:g}):T))},N=s=>{const h=parseFloat(s);return isNaN(h)?"0.000":(h/1e3).toFixed(3)},b=()=>{for(const s of n){if(!s.company)return x({title:"Validation Error",description:"Please select a company for all entries",variant:"destructive"}),!1;if(!s.bar_diameter)return x({title:"Validation Error",description:"Please select a bar diameter for all entries",variant:"destructive"}),!1;if(!s.pieces_used||isNaN(parseInt(s.pieces_used))||parseInt(s.pieces_used)<0)return x({title:"Validation Error",description:"Please enter valid pieces used for all entries",variant:"destructive"}),!1;if(!s.weight_kg||isNaN(parseFloat(s.weight_kg))||parseFloat(s.weight_kg)<0)return x({title:"Validation Error",description:"Please enter valid weight (kg) for all entries",variant:"destructive"}),!1}return!0},O=()=>M(null,null,function*(){if(b()){u(!0);try{const s=n.map(h=>({date:h.date,company:h.company,bar_diameter:h.bar_diameter,pieces_used:parseInt(h.pieces_used),weight_kg:parseFloat(h.weight_kg),notes:h.notes||void 0}));yield $.createBatch(s),x({title:"Success",description:`${s.length} offcut ${s.length===1?"entry":"entries"} added successfully`}),r(),l(!1)}catch(s){console.error("Failed to save offcut entries:",s),x({title:"Error",description:"Failed to save offcut entries. Please try again.",variant:"destructive"})}finally{u(!1)}}});return e.jsx(Ue,{open:t,onOpenChange:l,children:e.jsxs(ze,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsx(We,{children:e.jsxs(Ge,{children:["Add Offcut Entries - ",new Date(a).toLocaleDateString()]})}),e.jsxs("div",{className:"space-y-4",children:[n.map((s,h)=>e.jsxs("div",{className:"p-4 border rounded-lg space-y-4 bg-card",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h4",{className:"font-medium text-sm",children:["Entry ",h+1]}),n.length>1&&e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>c(s.id),className:"text-destructive hover:text-destructive",children:e.jsx(pe,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:`company-${s.id}`,children:"Company *"}),e.jsxs(ne,{value:s.company,onValueChange:g=>p(s.id,"company",g),disabled:o,children:[e.jsx(re,{id:`company-${s.id}`,children:e.jsx(le,{placeholder:o?"Loading...":"Select company"})}),e.jsx(oe,{children:f.length===0?e.jsx(K,{value:"no-companies",disabled:!0,children:o?"Loading companies...":"No companies for this date"}):f.map(g=>e.jsx(K,{value:g,children:g},g))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:`diameter-${s.id}`,children:"Bar Diameter *"}),e.jsxs(ne,{value:s.bar_diameter,onValueChange:g=>p(s.id,"bar_diameter",g),children:[e.jsx(re,{id:`diameter-${s.id}`,children:e.jsx(le,{placeholder:"Select diameter"})}),e.jsx(oe,{children:gs.map(g=>e.jsx(K,{value:g,children:g},g))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:`pieces-${s.id}`,children:"Pieces Used *"}),e.jsx(ce,{id:`pieces-${s.id}`,name:`pieces-${s.id}`,value:s.pieces_used,onChange:g=>p(s.id,"pieces_used",g),placeholder:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:`weight-${s.id}`,children:"Weight (kg) *"}),e.jsx(ce,{id:`weight-${s.id}`,name:`weight-${s.id}`,value:s.weight_kg,onChange:g=>p(s.id,"weight_kg",g),placeholder:"0.000"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Weight (Tons)"}),e.jsx(L,{value:N(s.weight_kg),readOnly:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:`notes-${s.id}`,children:"Notes"}),e.jsx(L,{id:`notes-${s.id}`,value:s.notes,onChange:g=>p(s.id,"notes",g.target.value),placeholder:"Optional remarks"})]})]})]},s.id)),e.jsxs(R,{variant:"outline",onClick:F,className:"w-full",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Add Row"]})]}),e.jsxs(He,{children:[e.jsx(R,{variant:"outline",onClick:()=>l(!1),disabled:j||o,children:"Cancel"}),e.jsxs(R,{onClick:O,disabled:j||o,children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),j?"Saving...":`Save All (${n.length})`]})]})]})})}function de({entries:t,onUpdate:l}){var E,F;const{user:a}=ue(),r=X((E=a==null?void 0:a.profile)==null?void 0:E.role,"edit"),n=X((F=a==null?void 0:a.profile)==null?void 0:F.role,"delete"),{toast:m}=xe(),[f,v]=d.useState(null),[o,i]=d.useState({}),j=c=>{v(c.id),i({company:c.company,bar_diameter:c.bar_diameter,pieces_used:c.pieces_used,weight_kg:c.weight_kg,notes:c.notes})},u=()=>{v(null),i({})},x=c=>M(null,null,function*(){try{yield $.update(c,o),m({title:"Success",description:"Entry updated successfully"}),v(null),i({}),l()}catch(p){console.error("Failed to update entry:",p),m({title:"Error",description:"Failed to update entry. Please try again.",variant:"destructive"})}}),w=c=>M(null,null,function*(){if(confirm("Are you sure you want to delete this entry?"))try{yield $.delete(c),m({title:"Success",description:"Entry deleted successfully"}),l()}catch(p){console.error("Failed to delete entry:",p),m({title:"Error",description:"Failed to delete entry. Please try again.",variant:"destructive"})}});return t.length===0?e.jsxs("div",{className:"text-center py-12 border rounded-lg bg-muted/20",children:[e.jsx("p",{className:"text-muted-foreground",children:"No offcut entries for this date"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:'Click "Add Offcut Entries" to get started'})]}):e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(je,{children:[e.jsx(fe,{children:e.jsxs(z,{children:[e.jsx(D,{children:"Date"}),e.jsx(D,{children:"Company"}),e.jsx(D,{children:"Bar Diameter"}),e.jsx(D,{className:"text-right",children:"Pieces Used"}),e.jsx(D,{className:"text-right",children:"Weight (kg)"}),e.jsx(D,{className:"text-right",children:"Weight (Tons)"}),e.jsx(D,{children:"Notes"}),(r||n)&&e.jsx(D,{className:"text-center",children:"Actions"})]})}),e.jsx(ve,{children:t.map(c=>{const p=f===c.id;return e.jsxs(z,{children:[e.jsx(y,{children:new Date(c.date).toLocaleDateString()}),e.jsx(y,{children:p?e.jsx(L,{value:o.company||"",onChange:N=>i(_(C({},o),{company:N.target.value})),className:"h-8"}):c.company}),e.jsx(y,{children:p?e.jsx(L,{value:o.bar_diameter||"",onChange:N=>i(_(C({},o),{bar_diameter:N.target.value})),className:"h-8"}):e.jsx(Y,{variant:"outline",children:c.bar_diameter})}),e.jsx(y,{className:"text-right",children:p?e.jsx(L,{type:"number",value:o.pieces_used||0,onChange:N=>i(_(C({},o),{pieces_used:parseInt(N.target.value)})),className:"h-8 text-right"}):c.pieces_used}),e.jsx(y,{className:"text-right",children:p?e.jsx(L,{type:"number",step:"0.001",value:o.weight_kg||0,onChange:N=>i(_(C({},o),{weight_kg:parseFloat(N.target.value)})),className:"h-8 text-right"}):c.weight_kg.toFixed(3)}),e.jsx(y,{className:"text-right font-medium",children:c.weight_tons.toFixed(3)}),e.jsx(y,{className:"max-w-xs truncate",children:p?e.jsx(L,{value:o.notes||"",onChange:N=>i(_(C({},o),{notes:N.target.value})),className:"h-8",placeholder:"Optional notes"}):c.notes||"-"}),(r||n)&&e.jsx(y,{className:"text-center",children:p?e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>x(c.id),children:e.jsx(Ie,{className:"h-4 w-4 text-green-600"})}),e.jsx(R,{variant:"ghost",size:"sm",onClick:u,children:e.jsx(Me,{className:"h-4 w-4 text-red-600"})})]}):e.jsxs("div",{className:"flex gap-2 justify-center",children:[r&&e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>j(c),children:e.jsx(ls,{className:"h-4 w-4"})}),n&&e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>w(c.id),className:"text-destructive hover:text-destructive",children:e.jsx(pe,{className:"h-4 w-4"})})]})})]},c.id)})})]})})}function me({totals:t}){const l=t.reduce((r,n)=>r+n.total_pieces,0),a=t.reduce((r,n)=>r+n.total_tons,0);return t.length===0?e.jsxs(S,{children:[e.jsx(k,{children:e.jsx(P,{children:"Per-Diameter Totals"})}),e.jsx(A,{children:e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No data available"})})]}):e.jsxs(S,{children:[e.jsx(k,{children:e.jsx(P,{children:"Per-Diameter Totals"})}),e.jsx(A,{children:e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(je,{children:[e.jsx(fe,{children:e.jsxs(z,{children:[e.jsx(D,{children:"Bar Diameter"}),e.jsx(D,{className:"text-right",children:"Total Pieces Used"}),e.jsx(D,{className:"text-right",children:"Total Weight (Tons)"})]})}),e.jsxs(ve,{children:[t.map(r=>e.jsxs(z,{children:[e.jsx(y,{children:e.jsx(Y,{variant:"outline",className:"font-medium",children:r.bar_diameter})}),e.jsx(y,{className:"text-right font-medium",children:r.total_pieces.toLocaleString()}),e.jsx(y,{className:"text-right font-bold",children:r.total_tons.toFixed(3)})]},r.bar_diameter)),e.jsxs(z,{className:"bg-muted/50 font-bold",children:[e.jsx(y,{children:"Grand Total"}),e.jsx(y,{className:"text-right",children:l.toLocaleString()}),e.jsx(y,{className:"text-right",children:a.toFixed(3)})]})]})]})})})]})}function fs({entries:t,diameterTotals:l,viewMode:a}){const r=d.useMemo(()=>t.reduce((i,j)=>i+j.pieces_used,0),[t]),n=d.useMemo(()=>t.reduce((i,j)=>i+j.weight_tons,0),[t]),m=d.useMemo(()=>{if(a!=="monthly")return[];const i=new Map;t.forEach(u=>{const x=u.date;i.set(x,(i.get(x)||0)+u.weight_tons)});const j=Array.from(i.entries()).map(([u,x])=>({date:new Date(u).toLocaleDateString("en-US",{month:"short",day:"numeric"}),tons:Math.round(x*1e3)/1e3}));return j.sort((u,x)=>new Date(u.date).getTime()-new Date(x.date).getTime()),j},[t,a]),f=d.useMemo(()=>[...l].sort((u,x)=>x.total_tons-u.total_tons).slice(0,3).map((u,x)=>{const w=n>0?(u.total_tons/n*100).toFixed(1):"0.0";return{rank:x+1,diameter:u.bar_diameter,tons:u.total_tons,percentage:w}}),[l,n]),v=i=>{switch(i){case 1:return"bg-yellow-500";case 2:return"bg-gray-400";case 3:return"bg-orange-600";default:return"bg-muted"}},o=i=>{switch(i){case 1:return"default";case 2:return"secondary";case 3:return"outline";default:return"outline"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(S,{children:[e.jsxs(k,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(P,{className:"text-sm font-medium",children:"Total Pieces Used"}),e.jsx(qe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(A,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a==="daily"?"Today":"Last 30 days"})]})]}),e.jsxs(S,{children:[e.jsxs(k,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(P,{className:"text-sm font-medium",children:"Total Tons Used"}),e.jsx(Ye,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(A,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.toFixed(3)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a==="daily"?"Today":"Last 30 days"})]})]}),e.jsxs(S,{children:[e.jsxs(k,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(P,{className:"text-sm font-medium",children:"Average per Entry"}),e.jsx(Je,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(A,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.length>0?(n/t.length).toFixed(3):"0.000"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Tons per entry"})]})]})]}),a==="monthly"&&m.length>0&&e.jsxs(S,{children:[e.jsx(k,{children:e.jsx(P,{children:"Daily Usage Trend (Last 30 Days)"})}),e.jsx(A,{children:e.jsx(es,{width:"100%",height:300,children:e.jsxs(os,{data:m,children:[e.jsx(ss,{strokeDasharray:"3 3"}),e.jsx(be,{dataKey:"date",tick:{fontSize:12},angle:-45,textAnchor:"end",height:80}),e.jsx(ye,{label:{value:"Tons",angle:-90,position:"insideLeft"},tick:{fontSize:12}}),e.jsx(ts,{formatter:i=>[`${i.toFixed(3)} tons`,"Total"],labelStyle:{color:"#000"}}),e.jsx(Ne,{dataKey:"tons",fill:"hsl(var(--primary))",radius:[8,8,0,0]})]})})})]}),f.length>0&&e.jsxs(S,{children:[e.jsx(k,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"h-5 w-5"}),"Top 3 Most Used Diameters"]})}),e.jsx(A,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:f.map(i=>e.jsxs(S,{className:"relative overflow-hidden",children:[e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${v(i.rank)}`}),e.jsx(k,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Y,{variant:o(i.rank),children:["Rank #",i.rank]}),e.jsx("span",{className:"text-2xl font-bold text-muted-foreground",children:i.rank===1?"ðŸ¥‡":i.rank===2?"ðŸ¥ˆ":"ðŸ¥‰"})]})}),e.jsxs(A,{className:"space-y-2",children:[e.jsx("div",{className:"text-3xl font-bold",children:i.diameter}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Tons:"}),e.jsx("span",{className:"font-bold",children:i.tons.toFixed(3)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"% of Total:"}),e.jsxs("span",{className:"font-bold",children:[i.percentage,"%"]})]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2 mt-3",children:e.jsx("div",{className:`h-2 rounded-full ${v(i.rank)}`,style:{width:`${i.percentage}%`}})})]})]},i.rank))})})]})]})}function Ls(){var O;const{user:t}=ue(),l=X((O=t==null?void 0:t.profile)==null?void 0:O.role,"edit"),[a,r]=d.useState(new Date().toISOString().split("T")[0]),[n,m]=d.useState("daily"),[f,v]=d.useState(!1),[o,i]=d.useState([]),[j,u]=d.useState([]),[x,w]=d.useState(!0),[E,F]=d.useState(new Map);d.useEffect(()=>{c()},[a,n]);const c=()=>M(null,null,function*(){w(!0);try{if(n==="daily"){const s=yield $.getByDate(a),h=$.calculateDiameterTotals(s);i(s),u(h)}else{const s=a,h=new Date(a);h.setDate(h.getDate()-30);const g=h.toISOString().split("T")[0],T=yield $.getByDateRange(g,s),B=$.calculateDiameterTotals(T);i(T),u(B);const W=new Map;T.forEach(G=>{const V=G.date;W.has(V)||W.set(V,[]),W.get(V).push(G)});const De=new Map(Array.from(W.entries()).sort((G,V)=>new Date(V[0]).getTime()-new Date(G[0]).getTime()));F(De)}}catch(s){console.error("Failed to load offcut data:",s)}finally{w(!1)}}),p=()=>{c()},N=s=>{r(s.target.value)},b=s=>{m(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-3xl font-bold",children:"Offcut Usage"})}),e.jsx(S,{children:e.jsx(k,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(I,{htmlFor:"date-picker",className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-4 w-4"}),"Select Date"]}),e.jsx(L,{id:"date-picker",type:"date",value:a,onChange:N,className:"w-auto"})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Be,{value:n,onValueChange:b,children:e.jsxs(Ve,{children:[e.jsx(ie,{value:"daily",children:"Daily View"}),e.jsx(ie,{value:"monthly",children:"Monthly View"})]})}),l&&e.jsxs(R,{onClick:()=>v(!0),children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Add Offcut Entries"]})]})]})})}),x?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading offcut data..."})]})}):e.jsxs(e.Fragment,{children:[e.jsx(fs,{entries:o,diameterTotals:j,viewMode:n}),n==="daily"?e.jsxs(e.Fragment,{children:[e.jsxs(S,{children:[e.jsx(k,{children:e.jsxs(P,{children:["Daily Offcut Entries - ",new Date(a).toLocaleDateString()]})}),e.jsx(A,{children:e.jsx(de,{entries:o,onUpdate:c})})]}),e.jsx(me,{totals:j})]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{totals:j}),e.jsxs(S,{children:[e.jsx(k,{children:e.jsx(P,{children:"Historical Entries (Last 30 Days)"})}),e.jsx(A,{className:"space-y-4",children:E.size===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No entries found for the last 30 days"}):Array.from(E.entries()).map(([s,h])=>{const g=h.reduce((T,B)=>T+B.weight_tons,0);return e.jsxs(xs,{className:"border rounded-lg",children:[e.jsx(us,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Ke,{className:"h-5 w-5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:new Date(s).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[h.length," ",h.length===1?"entry":"entries"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-bold",children:[g.toFixed(3)," tons"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[h.reduce((T,B)=>T+B.pieces_used,0)," pieces"]})]})]})}),e.jsx(ps,{children:e.jsx("div",{className:"p-4 pt-0",children:e.jsx(de,{entries:h,onUpdate:c})})})]},s)})})]})]})]}),e.jsx(js,{open:f,onOpenChange:v,selectedDate:a,onEntriesAdded:p})]})}export{Ls as OffcutUsagePage};
