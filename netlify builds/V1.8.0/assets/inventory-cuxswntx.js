var M=Object.defineProperty,P=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var W=(n,a,r)=>a in n?M(n,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[a]=r,k=(n,a)=>{for(var r in a||(a={}))z.call(a,r)&&W(n,r,a[r]);if(R)for(var r of R(a))U.call(a,r)&&W(n,r,a[r]);return n},I=(n,a)=>P(n,q(a));var _=(n,a,r)=>new Promise((h,N)=>{var p=o=>{try{f(r.next(o))}catch(u){N(u)}},x=o=>{try{f(r.throw(o))}catch(u){N(u)}},f=o=>o.done?h(o.value):Promise.resolve(o.value).then(p,x);f((r=r.apply(n,a)).next())});import{b as Y,r as d,j as e,C as L,B as D,X as Q,I as X,a as G,g as J,h as K,s as H,n as Z,p as ee,m as se}from"./index-DrtJc57V.js";import{T as te,a as ae,b as B,c as re,d as ne,e as le}from"./table-BVAkCOaz.js";import{S as ie}from"./square-pen-G00cnQUb.js";import{S as oe}from"./save-BJ2QkU2u.js";import{C as me}from"./circle-check-big-BN38TGIK.js";function ce({tableName:n,data:a,canEdit:r,lowStockThreshold:h,onUpdate:N,customHeaders:p}){const{toast:x}=Y(),[f,o]=d.useState(!1),[u,y]=d.useState({}),[g,S]=d.useState(!1);if(d.useEffect(()=>{o(!1),y({})},[a]),!a||a.length===0)return e.jsx(L,{children:e.jsx("div",{className:"p-6 text-center py-8 text-muted-foreground",children:"No data available for this table"})});const b=Object.keys(a[0]).filter(s=>s!=="id"&&s!=="created_at"&&s!=="updated_at"),t=a,l=s=>{if(s==null)return"-";const i=Number(s);return isNaN(i)?String(s):i.toFixed(3)},j=s=>{if(h===null)return!1;const i=Number(s);return isNaN(i)?!1:i<h},w=(s,i,m)=>{y(c=>I(k({},c),{[`${s}_${i}`]:m}))},v=()=>_(null,null,function*(){S(!0);const s=Object.entries(u);if(s.length===0){o(!1),S(!1);return}try{for(const[i,m]of s){const c=i.split("_"),E=c[0],$=c.slice(1).join("_"),T=Number(m);if(isNaN(T))throw new Error(`Invalid numeric value for ${$}`);yield N(n,Number(E),$,T)}x({title:"Success",description:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Changes saved successfully"})]})}),o(!1),y({})}catch(i){x({title:"Error",description:`Failed to save changes: ${i}`,variant:"destructive"})}finally{S(!1)}}),C=()=>{o(!1),y({})},F=(s,i)=>{var c;const m=`${s.id}_${i}`;return u[m]!==void 0?u[m]:String((c=s[i])!=null?c:"")};return e.jsx(L,{children:e.jsxs("div",{className:"p-6 space-y-4",children:[r&&e.jsx("div",{className:"flex justify-end gap-2",children:f?e.jsxs(e.Fragment,{children:[e.jsxs(D,{onClick:C,variant:"outline",size:"sm",className:"gap-2",disabled:g,children:[e.jsx(Q,{className:"h-4 w-4"}),"Cancel"]}),e.jsxs(D,{onClick:v,variant:"default",size:"sm",className:"gap-2",disabled:g,children:[e.jsx(oe,{className:"h-4 w-4"}),g?"Saving...":"Save Changes"]})]}):e.jsxs(D,{onClick:()=>o(!0),variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"Edit Values"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(te,{children:[e.jsx(ae,{children:e.jsx(B,{className:"border-border",children:b.map(s=>e.jsx(re,{className:"text-foreground",children:p&&p[s]?p[s]:s.replace(/_/g," ").toUpperCase()},s))})}),e.jsx(ne,{children:t.map((s,i)=>e.jsx(B,{className:"border-border hover:bg-muted/50",children:b.map(m=>{const c=s[m],E=!isNaN(Number(c))&&c!==null,T=f&&E&&!(m==="type"||m==="total"),O=j(c);return e.jsx(le,{className:`text-foreground ${O?"bg-red-50 text-red-700 font-medium":""}`,children:T?e.jsx(X,{type:"number",step:"0.001",value:F(s,m),onChange:A=>w(s.id,m,A.target.value),className:"w-full max-w-[150px] h-8 text-sm"}):e.jsx("span",{className:E||m==="total"?"font-mono":"",children:l(c)})},m)})},s.id||i))})]})}),h&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["* Values below ",h," tons are highlighted in red"]})]})})}const V=[{name:"qatar_steel",displayName:"Qatar Steel",lowStockThreshold:100,customHeaders:void 0},{name:"al_watania_steel",displayName:"AlWatania Steel",lowStockThreshold:100,customHeaders:void 0},{name:"special_length",displayName:"Special Length Watania Sections",lowStockThreshold:100,customHeaders:{type:"Length","16mm":"8.25m","20mm":"9m","25mm":"10m","32mm":"11.25m"}},{name:"coils",displayName:"Coils",lowStockThreshold:null,customHeaders:{type:"Coils","5.5mm":"5.5mm","6.5mm":"6.5mm","8mm":"8mm","9mm":"9mm","10mm":"10mm","11mm":"11mm","12mm":"12mm"}},{name:"wire",displayName:"Wire",lowStockThreshold:null,customHeaders:{type:"Type","8mm_6m_bundles":"8mm(6m)(Bundles)",wire_1_6mm_rolls:"wire 1.6mm(Rolls)",wire_3mm_rolls:"Wire 3mm(Rolls)",wire_mesh_10mm_sheet:"Wire mesh 10mm(Sheet)",wire_mesh_8mm_sheet:"Wire mesh 8mm(Sheet)",wire_mesh_6mm_sheet:"Wire mesh 6mm(Sheet)"}},{name:"coupler",displayName:"Coupler",lowStockThreshold:null,customHeaders:{type:"Coupler","12mm":"12mm","16mm":"16mm","20mm":"20mm","25mm":"25mm","32mm":"32mm","40mm":"40mm"}}];function ge(){var b;const{user:n}=G();J();const[a,r]=d.useState(""),[h,N]=d.useState({}),[p,x]=d.useState(!0),[f,o]=d.useState([]),u=K((b=n==null?void 0:n.profile)==null?void 0:b.role,"edit");d.useEffect(()=>{const t=new Date,l=`${String(t.getDate()).padStart(2,"0")}/${String(t.getMonth()+1).padStart(2,"0")}/${t.getFullYear()}`;r(l)},[]),d.useEffect(()=>{y();const t=V.map(l=>H.channel(`${l.name}_changes`).on("postgres_changes",{event:"*",schema:"public",table:l.name},()=>{g(l.name)}).subscribe());return o(t),()=>{t.forEach(l=>l.unsubscribe())}},[]);const y=()=>_(null,null,function*(){x(!0);const t=V.map(l=>g(l.name));yield Promise.all(t),x(!1)}),g=t=>_(null,null,function*(){try{const{data:l,error:j}=yield H.from(t).select("*").order("id",{ascending:!0});if(j){console.error(`Error loading ${t}:`,j);return}N(w=>I(k({},w),{[t]:l||[]}))}catch(l){console.error(`Failed to load ${t}:`,l)}}),S=(t,l,j,w)=>_(null,null,function*(){try{const v=Math.round(w*1e3)/1e3,{error:C}=yield H.from(t).update({[j]:v}).eq("id",l);if(C)throw console.error(`Error updating ${t}:`,C),C;yield g(t)}catch(v){throw console.error(`Failed to update ${t}:`,v),v}});return p?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Inventory"}),e.jsx("p",{className:"text-muted-foreground",children:a})]}),e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading inventory data..."})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Inventory"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:a})]}),V.map(t=>e.jsxs(L,{children:[e.jsx(Z,{children:e.jsx(ee,{children:t.displayName})}),e.jsx(se,{children:e.jsx(ce,{tableName:t.name,data:h[t.name]||[],canEdit:u,lowStockThreshold:t.lowStockThreshold,onUpdate:S,customHeaders:t.customHeaders})})]},t.name))]})}export{ge as Inventory};
