const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/driversStore-DAToLI8e.js","assets/index-BFnQ-UAH.js","assets/index-BIO773XR.css"])))=>i.map(i=>d[i]);
var oe=Object.defineProperty,de=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var Q=(o,d,r)=>d in o?oe(o,d,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[d]=r,D=(o,d)=>{for(var r in d||(d={}))ie.call(d,r)&&Q(o,r,d[r]);if(G)for(var r of G(d))le.call(d,r)&&Q(o,r,d[r]);return o},k=(o,d)=>de(o,ne(d));var T=(o,d,r)=>new Promise((m,a)=>{var i=u=>{try{v(r.next(u))}catch(j){a(j)}},b=u=>{try{v(r.throw(u))}catch(j){a(j)}},v=u=>u.done?m(u.value):Promise.resolve(u.value).then(i,b);v((r=r.apply(o,d)).next())});import{c as se,r as C,u as S,a as W,b as te,h as U,j as e,B as A,L as x,I as F,_ as ce,C as K,d as N,o as me,T as ue}from"./index-BFnQ-UAH.js";import{D as he,a as xe,b as ge,c as pe,d as be}from"./dialog-BRbg0aKC.js";import{S as R,a as I,b as M,c as L,d as w}from"./select-BRbBgvrF.js";import{C as ve,R as q,a as Z}from"./RoleBasedComponent-9rhSNb4B.js";import{S as Ne,E as fe,O as je}from"./OrderDetailsDialog-psrTq0zH.js";import{C as ye}from"./CalculatorInput-BrGfUfzl.js";import{P as De}from"./plus-RH-L6z1E.js";import{P as ke}from"./weight-BVtx7dRn.js";import{C as we}from"./phone-2z0wwj1A.js";import{T as Ce,a as Se,b as J,c as f,d as Oe,e as p}from"./table-D-XWPF1A.js";import{A as Te,a as Fe,b as Ae,c as $e,d as Pe,e as Be,f as Ee,g as _e,h as Re}from"./alert-dialog-CBJCpyBF.js";import{C as ee}from"./circle-check-big-Dfukt8JH.js";import{S as Ie}from"./square-pen-C3d0hzyQ.js";import{T as Me}from"./trash-2-D716UTzI.js";import{R as Le,C as qe,T as Ve}from"./generateCategoricalChart-BvjoGnZG.js";import{P as ze,a as He}from"./PieChart-BqpLXSby.js";import"./index-IC02_sX5.js";import"./calendar-BIOkxyxj.js";import"./calculator-iVhbMRQf.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["path",{d:"M5 12h14",key:"1ays0h"}]],Ue=se("minus",Je);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]],Ke=se("scissors",We);function Xe(){var Y;const[o,d]=C.useState(!1),[r,m]=C.useState({deliveryNumber:"",deliveryName:"",company:"",site:"",driverName:"none",phoneNumber:"",status:"in-progress",tons:"",shift:"morning",signedDeliveryNote:!1,orderType:"straight-bar",orderDate:new Date().toISOString().split("T")[0],breakdown:{"8mm":"","10mm":"","12mm":"","14mm":"","16mm":"","18mm":"","20mm":"","25mm":"","32mm":""}}),[a,i]=C.useState({}),[b,v]=C.useState(!1),{addOrder:u}=S(),{user:j}=W(),{toast:$}=te(),[E,P]=C.useState([]);C.useEffect(()=>{o&&T(null,null,function*(){try{const{useDriversStore:l}=yield ce(()=>T(null,null,function*(){const{useDriversStore:O}=yield import("./driversStore-DAToLI8e.js");return{useDriversStore:O}}),__vite__mapDeps([0,1,2])),{loadDrivers:c,getActiveDrivers:y}=l.getState();yield c();const g=y();P(g)}catch(l){console.error("Failed to load drivers:",l),P([])}})},[o]);const _=U((Y=j==null?void 0:j.profile)==null?void 0:Y.role,"create"),B=()=>Object.values(r.breakdown).reduce((s,l)=>{const c=parseFloat(l)||0;return s+c},0),t=()=>{const s={};(!r.deliveryNumber||r.deliveryNumber.trim()==="")&&(s.deliveryNumber="Delivery number is required"),(!r.deliveryName||r.deliveryName.trim()==="")&&(s.deliveryName="Delivery name is required"),(!r.company||r.company.trim()==="")&&(s.company="Company is required"),(!r.site||r.site.trim()==="")&&(s.site="Site is required"),(!r.orderDate||r.orderDate.trim()==="")&&(s.orderDate="Order date is required"),r.phoneNumber&&r.phoneNumber.trim()!==""&&!/^\+?[\d\s\-\(\)]+$/.test(r.phoneNumber)&&(s.phoneNumber="Please enter a valid phone number");const l=B(),c=parseFloat(r.tons)||0;!r.tons||r.tons.trim()===""?s.tons="Total tons is required":isNaN(Number(r.tons))||Number(r.tons)<=0?s.tons="Please enter a valid number of tons":l>0&&Math.abs(l-c)>.1&&(s.tons=`Total tons (${c}) doesn't match breakdown total (${l.toFixed(2)})`);const{orders:y,historyOrders:g}=S.getState(),O=r.deliveryNumber,z=y.find(H=>H.id===O),ae=g.find(H=>H.id===O);return(z||ae)&&(s.deliveryNumber=`Delivery number "${O}" already exists`),i(s),Object.keys(s).length===0},h=s=>T(null,null,function*(){if(s.preventDefault(),!_){$({title:"Access Denied",description:"You don't have permission to create orders. Contact your administrator.",variant:"destructive"});return}if(t())try{const l=r.deliveryNumber,c=Number(r.tons),y=c*100,g={id:l,customerName:r.deliveryName,date:new Date().toISOString().split("T")[0],status:r.status,amount:y,tons:c,shift:r.shift,deliveryNumber:r.deliveryNumber,company:r.company||"",site:r.site||"",driverName:r.driverName==="none"?"":r.driverName||"",phoneNumber:r.phoneNumber||"",signedDeliveryNote:r.signedDeliveryNote,orderType:r.orderType,breakdown:{"8mm":parseFloat(r.breakdown["8mm"])||0,"10mm":parseFloat(r.breakdown["10mm"])||0,"12mm":parseFloat(r.breakdown["12mm"])||0,"14mm":parseFloat(r.breakdown["14mm"])||0,"16mm":parseFloat(r.breakdown["16mm"])||0,"18mm":parseFloat(r.breakdown["18mm"])||0,"20mm":parseFloat(r.breakdown["20mm"])||0,"25mm":parseFloat(r.breakdown["25mm"])||0,"32mm":parseFloat(r.breakdown["32mm"])||0}};yield u(g),$({title:"Order Created",description:`Order ${l} has been successfully created.`}),m({deliveryNumber:"",deliveryName:"",company:"",site:"",driverName:"none",phoneNumber:"",status:"in-progress",tons:"",shift:"morning",signedDeliveryNote:!1,orderType:"straight-bar",breakdown:{"8mm":"","10mm":"","12mm":"","14mm":"","16mm":"","18mm":"","20mm":"","25mm":"","32mm":""}}),i({}),d(!1)}catch(l){console.error("Order creation failed:",l),$({title:"Error",description:l instanceof Error?l.message:"Failed to create order. Please try again.",variant:"destructive"})}}),n=(s,l)=>{m(c=>k(D({},c),{[s]:l})),a[s]&&i(c=>k(D({},c),{[s]:void 0}))},V=(s,l)=>{m(g=>k(D({},g),{breakdown:k(D({},g.breakdown),{[s]:l})}));const c=k(D({},r.breakdown),{[s]:l}),y=Object.values(c).reduce((g,O)=>{const z=parseFloat(O)||0;return g+z},0);y>0&&m(g=>k(D({},g),{tons:y.toFixed(2)}))},X=s=>{d(s),s||(m({deliveryNumber:"",deliveryName:"",company:"",site:"",driverName:"none",phoneNumber:"",status:"in-progress",tons:"",shift:"morning",signedDeliveryNote:!1,orderType:"straight-bar",orderDate:new Date().toISOString().split("T")[0],breakdown:{"8mm":"","10mm":"","12mm":"","14mm":"","16mm":"","18mm":"","20mm":"","25mm":"","32mm":""}}),i({}),v(!1),P([]))};return _?e.jsxs(he,{open:o,onOpenChange:X,children:[e.jsx(xe,{asChild:!0,children:e.jsxs(A,{className:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-md",children:[e.jsx(De,{size:20}),e.jsx("span",{className:"font-medium",children:"Add New Order"})]})}),e.jsxs(ge,{className:"sm:max-w-[700px] bg-background text-foreground max-h-[90vh] overflow-y-auto",children:[e.jsx(pe,{children:e.jsx(be,{className:"text-foreground",children:"Create New Order"})}),e.jsxs("form",{onSubmit:h,className:"space-y-6",id:"add-order-form",onReset:()=>{console.log("ðŸ”„ Form reset triggered"),i({}),v(!1)},children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-deliveryNumber",className:"text-foreground",children:"Delivery Number * (Can include letters, numbers, special characters)"}),e.jsx(F,{id:"add-deliveryNumber",name:"deliveryNumber",value:r.deliveryNumber,onChange:s=>n("deliveryNumber",s.target.value),placeholder:"Enter any delivery number (e.g., DEL-001, PROJ-2024-ABC, etc.)",className:`bg-background text-foreground border-border ${a.deliveryNumber?"border-destructive":""}`}),a.deliveryNumber&&e.jsx("p",{className:"text-sm text-destructive",children:a.deliveryNumber})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-deliveryName",className:"text-foreground",children:"Delivery Name *"}),e.jsx(F,{id:"add-deliveryName",name:"deliveryName",value:r.deliveryName,onChange:s=>n("deliveryName",s.target.value),placeholder:"John Smith",className:`bg-background text-foreground border-border ${a.deliveryName?"border-destructive":""}`}),a.deliveryName&&e.jsx("p",{className:"text-sm text-destructive",children:a.deliveryName})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-company",className:"text-foreground",children:"Company *"}),e.jsx(F,{id:"add-company",name:"company",value:r.company,onChange:s=>n("company",s.target.value),placeholder:"Acme Corporation",className:`bg-background text-foreground border-border ${a.company?"border-destructive":""}`}),a.company&&e.jsx("p",{className:"text-sm text-destructive",children:a.company})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-site",className:"text-foreground",children:"Site *"}),e.jsx(F,{id:"add-site",name:"site",value:r.site,onChange:s=>n("site",s.target.value),placeholder:"Main Warehouse - Building A",className:`bg-background text-foreground border-border ${a.site?"border-destructive":""}`}),a.site&&e.jsx("p",{className:"text-sm text-destructive",children:a.site})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-driverName",className:"text-foreground",children:"Driver Name"}),e.jsxs(R,{name:"driverName",value:r.driverName,onValueChange:s=>{if(n("driverName",s==="none"?"":s),s!=="none"){const c=E.find(y=>y.name===s);c&&n("phoneNumber",c.phone_number)}else n("phoneNumber","")},children:[e.jsx(I,{id:"add-driverName",className:"bg-background text-foreground border-border",children:e.jsx(M,{placeholder:"Select driver (optional)"})}),e.jsxs(L,{className:"bg-popover text-popover-foreground",children:[e.jsx(w,{value:"none",children:"No driver assigned"}),E.map(s=>e.jsx(w,{value:s.name,children:s.name},s.id))]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select from active drivers or leave empty"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-phoneNumber",className:"text-foreground",children:"Phone Number"}),e.jsx(F,{id:"add-phoneNumber",name:"phoneNumber",value:r.phoneNumber,onChange:s=>n("phoneNumber",s.target.value),placeholder:"+1 (555) 123-4567 (optional)",className:`bg-background text-foreground border-border ${a.phoneNumber?"border-destructive":""}`}),a.phoneNumber&&e.jsx("p",{className:"text-sm text-destructive",children:a.phoneNumber}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Can be updated later"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-order-date",className:"text-foreground",children:"Order Date *"}),e.jsx(F,{id:"add-order-date",name:"orderDate",type:"date",value:r.orderDate,onChange:s=>n("orderDate",s.target.value),className:`bg-background text-foreground border-border ${a.orderDate?"border-destructive":""}`}),a.orderDate&&e.jsx("p",{className:"text-sm text-destructive",children:a.orderDate})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-tons",className:"text-foreground",children:"Total Tons *"}),e.jsx(F,{id:"add-tons",name:"tons",type:"number",step:"0.1",value:r.tons,onChange:s=>n("tons",s.target.value),placeholder:"12.5",className:`bg-background text-foreground border-border ${a.tons?"border-destructive":""}`}),a.tons&&e.jsx("p",{className:"text-sm text-destructive",children:a.tons})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-shift",className:"text-foreground",children:"Shift"}),e.jsxs(R,{name:"shift",value:r.shift,onValueChange:s=>n("shift",s),children:[e.jsx(I,{id:"add-shift",className:"bg-background text-foreground border-border",children:e.jsx(M,{placeholder:"Select shift"})}),e.jsxs(L,{className:"bg-popover text-popover-foreground",children:[e.jsx(w,{value:"morning",children:"Morning Shift"}),e.jsx(w,{value:"night",children:"Night Shift"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-orderType",className:"text-foreground",children:"Order Type *"}),e.jsxs(R,{name:"orderType",value:r.orderType,onValueChange:s=>n("orderType",s),children:[e.jsx(I,{id:"add-orderType",className:"bg-background text-foreground border-border",children:e.jsx(M,{placeholder:"Select order type"})}),e.jsxs(L,{className:"bg-popover text-popover-foreground",children:[e.jsx(w,{value:"straight-bar",children:"Straight Bar"}),e.jsx(w,{value:"cut-and-bend",children:"Cut and Bend"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"add-status",className:"text-foreground",children:"Order Status"}),e.jsxs(R,{name:"status",value:r.status,onValueChange:s=>n("status",s),children:[e.jsx(I,{id:"add-status",className:"bg-background text-foreground border-border",children:e.jsx(M,{placeholder:"Select status"})}),e.jsxs(L,{className:"bg-popover text-popover-foreground",children:[e.jsx(w,{value:"in-progress",children:"In Progress"}),e.jsx(w,{value:"delivered",children:"Delivered"})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ve,{id:"add-signedDeliveryNote",checked:r.signedDeliveryNote,onCheckedChange:s=>n("signedDeliveryNote",s)}),e.jsx(x,{htmlFor:"add-signedDeliveryNote",className:"text-foreground",children:"Signed Delivery Note Received"})]}),e.jsx(Ne,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-foreground",children:"Steel Breakdown (Tons)"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Total: ",B().toFixed(2)," tons"]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:Object.entries(r.breakdown).map(([s,l])=>e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{htmlFor:`breakdown-${s}`,className:"text-xs text-foreground",children:s}),e.jsx(ye,{id:`breakdown-${s}`,name:`breakdown-${s}`,value:l,onChange:c=>V(s,c),placeholder:"0.0 or =10+5",className:"bg-background text-foreground border-border text-sm h-8",step:"0.1"})]},s))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'Enter tonnage for each steel bar size. Start with "=" for calculations (e.g., =10+5).'})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(A,{type:"button",variant:"outline",onClick:()=>X(!1),className:"bg-background text-foreground border-border hover:bg-accent hover:text-accent-foreground",disabled:b,children:"Cancel"}),e.jsx(A,{type:"submit",className:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-md",disabled:b,children:b?"Creating...":"Create Order"})]})]})]})]}):null}function Ye(){const{user:o}=W(),d=new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});return e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-headline font-bold text-foreground mb-2",children:"Al Watania Steel - Daily Orders"}),e.jsxs("p",{className:"text-muted-foreground",children:[d," - Track and manage steel deliveries"]})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx(q,{action:"create",children:e.jsx(Xe,{})})})]})})}function Ge(){const{stats:o}=S(),d=[{title:"Cut & Bend",value:`${o.cutAndBend} tons`,icon:Ke,color:"text-purple-600",bgColor:"bg-purple-100"},{title:"Straight Bar",value:`${o.straightBar} tons`,icon:Ue,color:"text-blue-600",bgColor:"bg-blue-100"},{title:"Today's Orders",value:o.todayOrders,icon:ke,color:"text-primary",bgColor:"bg-primary/10"},{title:"In Progress",value:o.inProgress,icon:we,color:"text-tertiary",bgColor:"bg-tertiary/10"}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:d.map((r,m)=>e.jsx(K,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:r.title}),e.jsx("p",{className:"text-3xl font-bold text-foreground",children:r.value})]}),e.jsx("div",{className:`p-3 rounded-lg ${r.bgColor}`,children:e.jsx(r.icon,{className:`h-6 w-6 ${r.color}`})})]})},m))})}function Qe(){var B;const{getFilteredTodayOrders:o,deleteOrder:d}=S(),{user:r}=W(),{toast:m}=te(),[a,i]=C.useState(null),[b,v]=C.useState(!1),u=o(),j=(B=r==null?void 0:r.profile)==null?void 0:B.role,$=t=>{switch(t){case"completed":return e.jsx(N,{className:"bg-success text-success-foreground",children:"Completed"});case"in-progress":return e.jsx(N,{className:"bg-tertiary text-tertiary-foreground",children:"In Progress"});case"delayed":return e.jsx(N,{className:"bg-warning text-warning-foreground",children:"Delayed"});case"pending":return e.jsx(N,{className:"bg-gray-400 text-white",children:"Pending"});case"delivered":return e.jsx(N,{className:"bg-green-600 text-white",children:"Delivered"});default:return e.jsx(N,{className:"bg-gray-400 text-white",children:t})}},E=t=>T(null,null,function*(){console.log("ðŸšš Truck button clicked for order:",t);const h=u.find(n=>n.id===t);if(!h)throw new Error("Order not found");console.log("ðŸ“¦ Order details:",{id:h.id,date:h.date,status:h.status});try{const{markAsDelivered:n}=S.getState();yield n(t),console.log("âœ… Order moved to history successfully")}catch(n){throw console.error("âŒ Failed to move order to history:",n),n}}),P=t=>{console.log("ðŸ” OrderTable - Selected order:",t),alert(`Debug: Order data = ${JSON.stringify({id:t.id,orderType:t.orderType,signedDeliveryNote:t.signedDeliveryNote,breakdown:t.breakdown},null,2)}`),i(t),v(!0)},_=t=>{d(t),m({title:"Order Deleted",description:`Order ${t} has been successfully deleted.`})};return e.jsxs(K,{children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Today's Orders"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[u.length," active orders"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ce,{children:[e.jsx(Se,{children:e.jsxs(J,{className:"border-border",children:[e.jsx(f,{className:"text-foreground",children:"Delivery Number"}),e.jsx(f,{className:"text-foreground",children:"Delivery Name"}),e.jsx(f,{className:"text-foreground",children:"Company"}),e.jsx(f,{className:"text-foreground",children:"Site"}),e.jsx(f,{className:"text-foreground",children:"Date"}),e.jsx(f,{className:"text-foreground",children:"Status"}),e.jsx(f,{className:"text-foreground",children:"Tons"}),e.jsx(f,{className:"text-foreground",children:"Shift"}),e.jsx(f,{className:"text-foreground",children:"Delivery Note"}),e.jsx(f,{className:"text-foreground",children:"Contact"}),e.jsx(f,{className:"text-foreground",children:"Actions"})]})}),e.jsx(Oe,{children:u.length>0?u.map(t=>e.jsxs(J,{className:"border-border hover:bg-muted/50",children:[e.jsx(p,{className:"font-mono text-foreground",children:t.id}),e.jsx(p,{className:"text-foreground",children:t.customerName}),e.jsx(p,{className:"text-foreground",children:t.company||"N/A"}),e.jsx(p,{className:"text-foreground",children:t.site||"N/A"}),e.jsx(p,{className:"text-foreground",children:t.date}),e.jsx(p,{children:$(t.status)}),e.jsxs(p,{className:"text-foreground",children:[t.tons," tons"]}),e.jsx(p,{children:e.jsx(N,{className:t.shift==="morning"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800",children:t.shift==="morning"?"Morning":"Night"})}),e.jsx(p,{children:e.jsx(q,{action:"edit",fallback:t.signedDeliveryNote?e.jsxs(N,{className:"bg-success text-success-foreground",children:[e.jsx(ee,{size:12,className:"mr-1"}),"Signed"]}):e.jsxs(N,{className:"bg-gray-400 text-white",children:[e.jsx(Z,{size:12,className:"mr-1"}),"Not Signed"]}),children:e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>T(null,null,function*(){try{const h=k(D({},t),{signedDeliveryNote:newStatus}),n=S.getState();if(n.updateOrder)yield n.updateOrder(h);else{const V={signed_delivery_note:newStatus};yield me.update(t.id,V),n.loadOrders&&(yield n.loadOrders())}m({title:"Delivery Note Updated",description:`Delivery note marked as ${t.signedDeliveryNote?"not signed":"signed"}.`})}catch(h){console.error("Failed to update delivery note:",h),m({title:"Error",description:"Failed to update delivery note. Please try again.",variant:"destructive"})}}),className:"p-0 h-auto hover:bg-transparent",title:`Click to mark as ${t.signedDeliveryNote?"not signed":"signed"}`,children:t.signedDeliveryNote?e.jsxs(N,{className:"bg-success text-success-foreground cursor-pointer hover:bg-success/80 transition-colors",children:[e.jsx(ee,{size:12,className:"mr-1"}),"Signed"]}):e.jsxs(N,{className:"bg-gray-400 text-white cursor-pointer hover:bg-gray-500 transition-colors",children:[e.jsx(Z,{size:12,className:"mr-1"}),"Not Signed"]})})})}),e.jsx(p,{children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-foreground",children:t.driverName||"N/A"}),t.phoneNumber?e.jsxs("a",{href:`tel:${t.phoneNumber.replace(/[\s\-\(\)]/g,"")}`,className:"text-sm text-primary hover:text-primary/80 underline cursor-pointer",title:"Click to call",children:["ðŸ“ž ",t.phoneNumber]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"-"})]})}),e.jsx(p,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>P(t),className:"bg-transparent text-foreground hover:bg-accent hover:text-accent-foreground",title:U(j,"edit")?"Edit Order Details":"View Order Details",children:U(j,"edit")?e.jsx(Ie,{size:16}):e.jsx(fe,{size:16})}),e.jsx(q,{action:"edit",children:t.status!=="delivered"&&e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>T(null,null,function*(){try{console.log("ðŸšš Truck button clicked for order:",t.id),console.log("ðŸ“¦ Order details:",{id:t.id,date:t.date,status:t.status}),yield E(t.id),m({title:"Order Delivered",description:`Order ${t.id} has been marked as delivered and moved to history.`})}catch(h){console.error("âŒ Mark as delivered failed:",h),m({title:"Error",description:h instanceof Error?h.message:"Failed to mark order as delivered. Please try again.",variant:"destructive"})}}),className:"bg-transparent text-success hover:bg-success/10 hover:text-success",title:"Mark as Delivered",children:e.jsx(ue,{size:16})})}),e.jsx(q,{action:"delete",children:e.jsxs(Te,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"sm",className:"bg-transparent text-destructive hover:bg-destructive/10 hover:text-destructive",title:"Delete Order",children:e.jsx(Me,{size:16})})}),e.jsxs(Ae,{className:"bg-background text-foreground","aria-describedby":"delete-order-description",children:[e.jsxs($e,{children:[e.jsx(Pe,{children:"Are you sure?"}),e.jsxs(Be,{id:"delete-order-description",className:"text-muted-foreground",children:["This action cannot be undone. This will permanently delete order ",t.id,"."]})]}),e.jsxs(Ee,{children:[e.jsx(_e,{className:"bg-background text-foreground border-border hover:bg-accent",children:"Cancel"}),e.jsx(Re,{onClick:()=>_(t.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})})]})})]},t.id)):e.jsx(J,{children:e.jsx(p,{colSpan:11,className:"text-center text-muted-foreground py-8",children:"No orders for today yet. Create your first order!"})})})]})})]}),e.jsx(je,{order:a,open:b,onOpenChange:v})]})}const re=["hsl(232, 90%, 62%)","hsl(280, 85%, 60%)","hsl(340, 82%, 52%)","hsl(25, 95%, 53%)","hsl(48, 96%, 53%)","hsl(142, 71%, 45%)","hsl(199, 89%, 48%)","hsl(271, 81%, 56%)","hsl(355, 78%, 60%)"];function Ze(){const{orders:o}=S(),d=o.filter(a=>a.breakdown&&Object.values(a.breakdown).some(i=>i>0)).reduce((a,i)=>(i.breakdown&&Object.entries(i.breakdown).forEach(([b,v])=>{a[b]||(a[b]=0),a[b]+=v||0}),a),{}),r=Object.entries(d).map(([a,i])=>({name:a,value:Math.round(i*100)/100})).filter(a=>a.value>0).sort((a,i)=>parseInt(a.name)-parseInt(i.name)),m=r.reduce((a,i)=>a+i.value,0);return e.jsxs(K,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-4",children:"Steel Breakdown Analytics"}),e.jsx("div",{className:"h-80",children:r.length>0?e.jsx(Le,{width:"100%",height:"100%",children:e.jsxs(ze,{children:[e.jsx(He,{data:r,cx:"50%",cy:"50%",labelLine:!1,label:({name:a,percent:i})=>`${a}: ${(i*100).toFixed(1)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:r.map((a,i)=>e.jsx(qe,{fill:re[i%re.length]},`cell-${i}`))}),e.jsx(Ve,{contentStyle:{backgroundColor:"hsl(0, 0%, 100%)",border:"1px solid hsl(240, 4%, 80%)",borderRadius:"8px",color:"hsl(0, 0%, 12%)"},formatter:a=>[`${a} tons`,"Total"]})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"No steel breakdown data available"})}),e.jsxs("div",{className:"mt-4 text-sm text-muted-foreground",children:["Active orders steel breakdown: ",m.toFixed(2)," tons total from ",r.length," bar sizes"]})]})}function fr(){const{loading:o,orders:d}=S();return o&&d.length===0?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading dashboard data..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ye,{}),e.jsx(Ge,{}),e.jsx(Qe,{}),e.jsx(Ze,{})]})}export{fr as Dashboard};
