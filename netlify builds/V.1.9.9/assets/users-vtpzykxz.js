var h=(n,b,i)=>new Promise((d,o)=>{var x=r=>{try{m(i.next(r))}catch(t){o(t)}},w=r=>{try{m(i.throw(r))}catch(t){o(t)}},m=r=>r.done?d(r.value):Promise.resolve(r.value).then(x,w);m((i=i.apply(n,b)).next())});import{c as k,r as c,a as M,b as _,h as B,s as N,j as e,C as U,l as S,S as H,m as V,n as L,p as R,q as O,B as p,d as u,e as q}from"./index-BFnQ-UAH.js";import{S as z,a as F,b as G,c as I,d as y}from"./select-BRbBgvrF.js";import{T as $,a as Q,b as E,c as j,d as Y,e as g}from"./table-D-XWPF1A.js";import{D as J,a as K,b as W,c as X,d as Z}from"./dialog-BRbg0aKC.js";import{T as P}from"./trash-2-D716UTzI.js";import{A as ee}from"./arrow-left-DGxMWm4D.js";import"./index-IC02_sX5.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],re=k("user-plus",se);function ae(){var C;const[n,b]=c.useState([]),[i,d]=c.useState(!0),[o,x]=c.useState(!1),[w,m]=c.useState({email:"",password:"",role:"viewer"}),{user:r}=M(),{toast:t}=_(),f=B((C=r==null?void 0:r.profile)==null?void 0:C.role,"delete");c.useEffect(()=>{f&&v()},[f]);const v=()=>h(null,null,function*(){try{d(!0);const{data:s,error:l}=yield N.from("profiles").select("*").order("created_at",{ascending:!1});if(l)throw l;b(s||[])}catch(s){console.error("Error loading users:",s),t({title:"Error",description:"Failed to load users",variant:"destructive"})}finally{d(!1)}}),A=(s,l)=>h(null,null,function*(){try{const{error:a}=yield N.from("profiles").update({role:l,updated_at:new Date().toISOString()}).eq("id",s);if(a)throw a;t({title:"Success",description:"User role updated successfully"}),v()}catch(a){console.error("Error updating user role:",a),t({title:"Error",description:a.message||"Failed to update user role",variant:"destructive"})}}),D=(s,l)=>h(null,null,function*(){if(confirm(`Are you sure you want to delete user ${l}?`))try{const{error:a}=yield N.auth.admin.deleteUser(s);if(a)throw a;t({title:"Success",description:`User ${l} deleted successfully`}),v()}catch(a){console.error("Error deleting user:",a),t({title:"Error",description:a.message||"Failed to delete user",variant:"destructive"})}}),T=s=>{switch(s){case"admin":return e.jsx(u,{className:"bg-purple-100 text-purple-800",children:"Admin"});case"editor":return e.jsx(u,{className:"bg-green-100 text-green-800",children:"Editor"});case"viewer":return e.jsx(u,{className:"bg-blue-100 text-blue-800",children:"Viewer"});default:return e.jsx(u,{className:"bg-gray-100 text-gray-800",children:s})}};return f?e.jsx("div",{className:"space-y-6",children:e.jsxs(U,{children:[e.jsx(V,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"User Management"]}),e.jsx(O,{children:"Manage user accounts and role assignments"})]}),e.jsxs(J,{open:o,onOpenChange:x,children:[e.jsx(K,{asChild:!0,children:e.jsxs(p,{children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"User Creation Guide"]})}),e.jsxs(W,{className:"max-w-2xl",children:[e.jsx(X,{children:e.jsx(Z,{children:"How to Create New Users"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"ðŸ“‹ Method 1: Supabase Dashboard"}),e.jsxs("ol",{className:"text-sm text-blue-700 space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:"Go to Supabase Dashboard â†’ Authentication â†’ Users"}),e.jsx("li",{children:'Click "Add User"'}),e.jsx("li",{children:"Enter email and password"}),e.jsx("li",{children:'Check "Auto Confirm User" âœ…'}),e.jsx("li",{children:'Click "Create User"'}),e.jsx("li",{children:"Come back here to assign roles"})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"ðŸŽ¯ Method 2: Email Patterns (Automatic)"}),e.jsx("p",{className:"text-sm text-green-700 mb-2",children:"Users can sign up and get roles automatically:"}),e.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("code",{children:"admin@company.com"})," â†’ Admin role"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("code",{children:"editor@company.com"})," â†’ Editor role"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("code",{children:"manager@company.com"})," â†’ Editor role"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("code",{children:"user@company.com"})," â†’ Viewer role"]})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-yellow-800 mb-2",children:"âš¡ Quick Test Users"}),e.jsx("p",{className:"text-sm text-yellow-700 mb-2",children:"Create these in Supabase Dashboard:"}),e.jsxs("div",{className:"text-xs font-mono space-y-1",children:[e.jsxs("div",{children:["ðŸ“§ ",e.jsx("code",{children:"viewer@test.com"})," â†’ Viewer"]}),e.jsxs("div",{children:["ðŸ“§ ",e.jsx("code",{children:"editor@test.com"})," â†’ Editor"]}),e.jsxs("div",{children:["ðŸ“§ ",e.jsx("code",{children:"newadmin@test.com"})," â†’ Admin"]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(p,{onClick:()=>x(!1),children:"Got it!"})})]})]})]})]})}),e.jsx(S,{children:i?e.jsx("div",{className:"text-center py-8",children:"Loading users..."}):e.jsxs($,{children:[e.jsx(Q,{children:e.jsxs(E,{children:[e.jsx(j,{children:"Email"}),e.jsx(j,{children:"Role"}),e.jsx(j,{children:"Created"}),e.jsx(j,{children:"Actions"})]})}),e.jsx(Y,{children:n.map(s=>e.jsxs(E,{children:[e.jsx(g,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.email}),s.full_name&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.full_name})]})}),e.jsx(g,{children:T(s.role)}),e.jsx(g,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(g,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{value:s.role,onValueChange:l=>A(s.id,l),children:[e.jsx(F,{className:"w-32",children:e.jsx(G,{})}),e.jsxs(I,{children:[e.jsx(y,{value:"viewer",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Viewer"]})}),e.jsx(y,{value:"editor",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Editor"]})}),e.jsx(y,{value:"admin",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),"Admin"]})})]})]}),s.email!==(r==null?void 0:r.email)&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>D(s.id,s.email),className:"text-destructive hover:text-destructive",children:e.jsx(P,{className:"h-4 w-4"})})]})})]},s.id))})]})})]})}):e.jsx(U,{children:e.jsxs(S,{className:"p-6 text-center",children:[e.jsx(H,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-muted-foreground",children:"You need admin privileges to manage users."})]})})}function me(){const n=q();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>n("/"),className:"text-foreground hover:bg-accent",children:[e.jsx(ee,{size:16}),"Back to Dashboard"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-headline font-bold text-foreground",children:"User Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage user accounts and role assignments"})]})]}),e.jsx(ae,{})]})}export{me as Users};
